<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mythical Adventure - MMORPG</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* === ESTILOS GENERALES (RESET) === */
        * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-user-select: none; outline: none; }
        body { margin: 0; padding: 0; background-color: #050505; overflow: hidden; font-family: 'Lato', sans-serif; color: #e0e0e0; }

        #game-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        /* === PANTALLA DE LOGIN (ESTILO DARK FANTASY) === */
        #login-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #2a1010 0%, #000000 90%); /* Fondo rojizo oscuro */
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 5000; transition: opacity 0.5s;
        }

        .game-logo {
            font-family: 'Cinzel', serif; color: #ffb700; 
            text-shadow: 0 0 10px #ff0000, 0 5px 0 #330000; 
            font-size: 3rem; margin-bottom: 20px; text-align: center; letter-spacing: 2px;
        }

        .login-panel {
            background: rgba(20, 15, 15, 0.95); 
            border: 2px solid #5c4033; /* Borde marr√≥n piedra */
            border-top: 4px solid #8b0000; /* Borde superior rojo */
            padding: 25px; border-radius: 8px; 
            box-shadow: 0 0 50px rgba(0,0,0,0.9), inset 0 0 20px rgba(0,0,0,0.8);
            width: 90%; max-width: 420px; 
            display: flex; flex-direction: column; gap: 15px;
            position: relative;
        }

        /* Decoraci√≥n de esquinas (Simulada con pseudo-elementos) */
        .login-panel::before { content: ''; position: absolute; top: -5px; left: -5px; width: 20px; height: 20px; border-top: 2px solid #ffb700; border-left: 2px solid #ffb700; }
        .login-panel::after { content: ''; position: absolute; bottom: -5px; right: -5px; width: 20px; height: 20px; border-bottom: 2px solid #ffb700; border-right: 2px solid #ffb700; }

        input { 
            background: #0a0a0a; border: 1px solid #444; color: #d4af37; 
            padding: 15px; font-size: 18px; border-radius: 4px; text-align: center; width: 100%;
            font-family: 'Cinzel', serif; box-shadow: inset 0 0 5px #000;
        }
        input::placeholder { color: #555; }
        input:focus { border-color: #8b0000; box-shadow: 0 0 10px #8b0000; }

        /* CLASES (iconos) */
        .class-selector { display: flex; gap: 10px; justify-content: center; margin: 10px 0; }
        .class-card {
            width: 75px; height: 95px; 
            background: linear-gradient(180deg, #2a2a2a, #111);
            border: 1px solid #444; border-radius: 6px; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .class-card.selected { 
            border: 2px solid #ffb700; 
            background: linear-gradient(180deg, #3d0000, #1a0000); 
            box-shadow: 0 0 15px rgba(255, 60, 0, 0.4);
        }
        .class-icon { font-size: 32px; margin-bottom: 5px; filter: drop-shadow(0 0 2px #000); }
        .class-name { font-size: 10px; color: #888; text-transform: uppercase; font-weight: bold; font-family: 'Cinzel', serif; }
        .class-card.selected .class-name { color: #ffb700; }

        /* BOT√ìN DE ENTRAR (Estilo RPG Rojo) */
        #start-btn {
            background: linear-gradient(180deg, #a80000, #550000); /* Rojo Sangre */
            color: #ffebd7; border: 2px solid #ffb700;
            padding: 18px; font-size: 18px; font-weight: bold; border-radius: 4px; cursor: pointer; 
            font-family: 'Cinzel', serif; text-shadow: 1px 1px 0 #000;
            box-shadow: 0 4px 0 #330000, 0 5px 10px rgba(0,0,0,0.5);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        #start-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #330000; }
        #start-btn:disabled { background: #333; border-color: #555; color: #777; cursor: not-allowed; transform: none; box-shadow: none; }

        /* === HUD DEL JUEGO === */
        #game-ui { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        #game-ui > * { pointer-events: auto; }

        /* PERFIL (Arriba Izquierda) */
        .player-profile {
            position: absolute; top: 15px; left: 15px; 
            display: flex; align-items: center; gap: 10px;
            background: linear-gradient(90deg, rgba(0,0,0,0.9), rgba(0,0,0,0)); 
            padding: 8px 20px 8px 8px; border-radius: 4px;
            border-left: 3px solid #ffb700;
        }
        .avatar-frame { 
            width: 54px; height: 54px; border-radius: 4px; 
            border: 2px solid #5c4033; background: #000; overflow: hidden; 
            box-shadow: 0 0 10px #000;
        }
        .bars { width: 140px; display: flex; flex-direction: column; gap: 5px; }
        .bar-container { height: 14px; background: #111; position: relative; border: 1px solid #333; border-radius: 2px; }
        .bar-fill { height: 100%; transition: width 0.3s ease-out; box-shadow: inset 0 -2px 5px rgba(0,0,0,0.5); }
        .hp-fill { background: linear-gradient(90deg, #d32f2f, #8e0000); } /* Degradado Rojo */
        .mp-fill { background: linear-gradient(90deg, #1976d2, #0d47a1); } /* Degradado Azul */
        .bar-text { position: absolute; width: 100%; text-align: center; font-size: 10px; line-height: 14px; top: 0; color: #fff; text-shadow: 1px 1px 0 #000; font-weight: bold; }

        /* CHAT (Abajo Izquierda) */
        #chat-system { 
            position: absolute; bottom: 120px; left: 15px; width: 300px; 
            display: flex; flex-direction: column; gap: 5px; 
        }
        #chat-log { 
            height: 120px; overflow-y: auto; 
            background: rgba(0, 0, 0, 0.6); 
            border: 1px solid #444; border-left: 2px solid #ffb700;
            padding: 8px; display: flex; flex-direction: column-reverse; 
            border-radius: 4px; font-size: 12px;
            text-shadow: 1px 1px 0 #000;
        }
        .chat-input-row { display: flex; gap: 5px; }
        #chat-input { 
            background: rgba(0,0,0,0.8); border: 1px solid #555; color: #ddd; 
            flex-grow: 1; padding: 8px; border-radius: 2px; font-family: 'Lato', sans-serif; text-align: left;
        }
        #chat-send { 
            background: #333; color: #ffb700; border: 1px solid #555; 
            width: 40px; cursor: pointer; font-weight: bold;
        }

        /* BARRA DE ACCI√ìN (Abajo Derecha) */
        .action-bar { 
            position: absolute; bottom: 20px; right: 20px; 
            display: flex; gap: 12px; align-items: flex-end; 
        }
        .action-slot { position: relative; width: 60px; height: 60px; }
        
        .btn { 
            width: 100%; height: 100%; 
            border-radius: 8px; 
            border: 2px solid #5c4033; /* Borde Piedra */
            background: radial-gradient(circle, #3a3a3a, #111); 
            color: #ddd; font-size: 24px; cursor: pointer;
            box-shadow: 0 4px 0 #222; transition: all 0.1s;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; border-color: #888; }
        
        /* Bot√≥n de Ataque Grande */
        .attack-slot { width: 85px; height: 85px; }
        .attack-btn { 
            background: radial-gradient(circle, #660000, #330000); /* Rojo Oscuro */
            border-color: #a80000; font-size: 36px; color: #ffb700;
        }

        .hotkey-label { 
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%); 
            background: #000; border: 1px solid #555; color: #aaa;
            font-size: 9px; padding: 2px 6px; border-radius: 4px; pointer-events: none;
        }

        /* VERSI√ìN AGUA (Marca) */
        .version-tag { color: #444; font-size: 10px; margin-top: 15px; text-align: center; font-family: monospace; }
    </style>
</head>
<body>
    <div id="game-container"></div>

    <div id="login-screen">
        <div class="game-logo">MYTHICAL<br>ADVENTURE</div>
        
        <div class="login-panel">
            <input type="text" id="username-input" placeholder="Nombre del H√©roe" maxlength="12">
            
            <div class="class-selector">
                <div class="class-card selected" onclick="selectClass('knight', this)"><div class="class-icon">üõ°Ô∏è</div><div class="class-name">Knight</div></div>
                <div class="class-card" onclick="selectClass('mage', this)"><div class="class-icon">üî•</div><div class="class-name">Mage</div></div>
                <div class="class-card" onclick="selectClass('paladin', this)"><div class="class-icon">üèπ</div><div class="class-name">Paladin</div></div>
                <div class="class-card" onclick="selectClass('healer', this)"><div class="class-icon">‚ú®</div><div class="class-name">Healer</div></div>
            </div>

            <button id="start-btn" onclick="startGame()">ENTRAR AL MUNDO</button>
            <div class="version-tag">Cliente v10002 ‚Ä¢ Servidor Industrial</div>
        </div>
    </div>

    <div id="game-ui">
        <div class="player-profile">
            <div class="avatar-frame"><img src="client/assets/sprites/otsp_creatures_01.png" id="ui-avatar" style="object-fit: none; object-position: 0 0;"></div>
            <div class="bars">
                <div class="bar-container"><div class="bar-text" id="hp-text">100/100</div><div class="bar-fill hp-fill" id="hp-bar" style="width: 100%"></div></div>
                <div class="bar-container"><div class="bar-text" id="mp-text">50/50</div><div class="bar-fill mp-fill" id="mp-bar" style="width: 100%"></div></div>
            </div>
        </div>

        <div id="chat-system">
            <div id="chat-log"><div style="color:#ffb700;">Bienvenido a Mythical Adventure.</div></div>
            <div class="chat-input-row"><input type="text" id="chat-input" placeholder="Escribe aqu√≠..."><button id="chat-send" onclick="sendChat()">‚û§</button></div>
        </div>

        <div class="action-bar">
            <div class="action-slot"><span class="hotkey-label">CURAR</span><button class="btn" onclick="emitAction('HEAL')">üíä</button></div>
            <div class="action-slot"><span class="hotkey-label">MAGIA</span><button class="btn" onclick="emitAction('SPELL_1')">üî•</button></div>
            <div class="action-slot attack-slot"><span class="hotkey-label">ATACAR</span><button class="btn attack-btn" onclick="emitAction('ATTACK')">‚öîÔ∏è</button></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/colyseus.js@0.15.0/dist/colyseus.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser3-rex-plugins@1.1.84/dist/rexvirtualjoystickplugin.min.js"></script>
    
    <script src="client/index.js?v=10002"></script>

    <script>
        let selectedClass = 'knight';
        
        // Manejo de Errores Global
        window.onerror = function(msg) {
            const btn = document.getElementById('start-btn');
            btn.innerText = "ERROR - RECARGA";
            btn.style.background = "#330000";
            console.error("Game Error:", msg);
        };

        function selectClass(cls, el) {
            selectedClass = cls;
            document.querySelectorAll('.class-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
        }

        function startGame() {
            const name = document.getElementById('username-input').value.trim();
            if(!name) return;
            const btn = document.getElementById('start-btn');
            btn.disabled = true; btn.innerText = "CONECTANDO...";
            
            // Iniciar conexi√≥n
            window.dispatchEvent(new CustomEvent('start-game', { detail: { name: name, role: selectedClass } }));
            
            // Timeout de seguridad
            setTimeout(() => { 
                if(btn.disabled && document.getElementById('login-screen').style.display !== 'none') {
                     btn.innerText = "REINTENTAR"; btn.disabled = false; 
                }
            }, 10000);
        }

        function emitAction(t) { window.dispatchEvent(new CustomEvent('game-action', { detail: t })); }
        
        function sendChat() {
            const i = document.getElementById('chat-input');
            if(i.value.trim()) { 
                window.dispatchEvent(new CustomEvent('game-action', { detail: i.value })); 
                
                // Feedback local inmediato
                const log = document.getElementById('chat-log');
                log.innerHTML = `<div style="color:#aaa;">T√∫: ${i.value}</div>` + log.innerHTML;
                i.value = ''; 
            }
        }
    </script>
</body>
</html>
