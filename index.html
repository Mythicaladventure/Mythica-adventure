<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mythica Adventure - Full System</title>
    <style>
        :root { 
            --gold: #d4af37; --health: #ff3e3e; --mana: #3e93ff; --exp: #4caf50;
            --beige: #e5d3b3; --dark: #1a1a1a; --glow: rgba(255, 255, 255, 0.5);
            --panel: #d2b48c; /* Beige Tibia Style */
        }
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Verdana', sans-serif; color: #1a1a1a; }
        
        /* PANTALLA DE INICIO PROFESIONAL */
        #setup { position: absolute; inset: 0; background: var(--dark); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5000; }
        .card { background: var(--beige); border: 3px solid #000; padding: 20px; width: 200px; text-align: center; margin: 10px; cursor: pointer; font-weight: bold; box-shadow: 0 5px 0 #8b7d6b; }
        .card:active { transform: translateY(3px); box-shadow: none; }

        /* HUD SUPERIOR */
        #hud { position: absolute; top: 10px; left: 10px; background: var(--beige); padding: 12px; border: 3px solid #000; z-index: 100; display: none; box-shadow: 0 0 15px var(--glow); }
        .bar-wrap { width: 180px; height: 16px; background: #333; border: 2px solid #000; margin-top: 5px; position: relative; }
        .bar-fill { height: 100%; transition: width 0.3s ease; }
        .bar-text { position: absolute; width: 100%; text-align: center; font-size: 10px; color: #fff; font-weight: bold; line-height: 16px; }

        /* MEN√ö MAESTRO */
        #menu-container { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 95%; height: 85%; background: var(--panel); border: 4px solid #000;
            display: none; flex-direction: column; z-index: 1000; 
        }
        .tabs { display: flex; background: #2c2c2c; height: 50px; }
        .tab { flex: 1; display: flex; align-items: center; justify-content: center; color: var(--beige); font-size: 11px; font-weight: bold; border: 1px solid #444; cursor: pointer; }
        .tab.active { background: var(--beige); color: #000; }

        .view { flex: 1; padding: 15px; overflow-y: auto; display: none; }
        .view.active { display: block; }

        /* ESTILOS DE CADA SECCI√ìN */
        .guide-text { background: rgba(0,0,0,0.1); border-left: 5px solid #000; padding: 10px; margin-bottom: 15px; font-size: 12px; line-height: 1.4; }
        
        .stats-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-card { background: #c5b291; border: 2px solid #000; padding: 8px; }
        .stat-val { font-size: 18px; font-weight: bold; display: block; }
        .train-bar { width: 100%; height: 4px; background: #444; margin-top: 4px; }
        .train-fill { height: 100%; background: var(--gold); width: 0%; }

        /* INVENTARIO DOBLE */
        .inv-header { background: #000; color: #fff; padding: 5px; font-size: 11px; margin-top: 10px; display: flex; justify-content: space-between; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; margin-top: 5px; }
        .slot { aspect-ratio: 1/1; background: #b8a07e; border: 2px solid #000; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* EQUIPO TIBIA STYLE */
        .eq-map { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 150px; margin: 0 auto; }

        /* BOTONES ACCI√ìN JUEGO */
        #game-ui { position: absolute; bottom: 20px; right: 20px; display: none; gap: 10px; }
        .action-btn { width: 80px; height: 80px; background: var(--beige); border: 4px solid #000; border-radius: 10px; font-weight: bold; box-shadow: 0 4px 0 #8b7d6b; }
        
        /* DA√ëO FLOTANTE */
        .dmg-num { position: absolute; font-weight: bold; font-size: 22px; text-shadow: 2px 2px #000; pointer-events: none; animation: fly 0.8s forwards; }
        @keyframes fly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }

        canvas { display: block; }
    </style>
</head>
<body>

    <div id="setup">
        <h1 style="color:var(--beige); letter-spacing: 5px;">MYTHICA ADVENTURE</h1>
        <div class="card" onclick="startGame('GUERRERO')">GUERRERO</div>
        <div class="card" onclick="startGame('MAGO')">MAGO</div>
        <div class="card" onclick="startGame('ARQUERO')">ARQUERO</div>
    </div>

    <div id="hud">
        <div id="p-header" style="font-weight:bold; font-size:12px;">ADVENTURER LV. 1</div>
        <div class="bar-wrap"><div class="bar-text" id="hp-txt">100/100</div><div id="hp-f" class="bar-fill" style="background:var(--health); width:100%"></div></div>
        <div class="bar-wrap"><div class="bar-text" id="mp-txt">50/50</div><div id="mp-f" class="bar-fill" style="background:var(--mana); width:100%"></div></div>
        <div id="gold-hud" style="font-weight:bold; margin-top:8px;">üí∞ 0000</div>
    </div>

    <div id="menu-container">
        <div class="tabs">
            <div class="tab active" onclick="openTab(event, 'tab-stats')">üë§ PERFIL</div>
            <div class="tab" onclick="openTab(event, 'tab-inv')">üéí BOLSA</div>
            <div class="tab" onclick="openTab(event, 'tab-diario')">‚öîÔ∏è DIARIO</div>
            <div class="tab" onclick="openTab(event, 'tab-config')">‚öôÔ∏è AJUSTES</div>
            <div class="tab" style="background:#800; color:white; flex:0.5" onclick="toggleMenu()">X</div>
        </div>

        <div id="tab-stats" class="view active">
            <div class="guide-text"><b>Orientaci√≥n:</b> Tu poder crece mediante el entrenamiento constante. Cada golpe que das o recibes aumenta tu progreso de habilidad.</div>
            <div class="stats-box">
                <div class="stat-card">FUERZA <span class="stat-val" id="stat-str">10</span> <div class="train-bar"><div class="train-fill" id="t-str"></div></div></div>
                <div class="stat-card">MAGIA <span class="stat-val" id="stat-mag">10</span> <div class="train-bar"><div class="train-fill" id="t-mag"></div></div></div>
                <div class="stat-card">DEFENSA <span class="stat-val" id="stat-def">10</span> <div class="train-bar"><div class="train-fill" id="t-def"></div></div></div>
                <div class="stat-card">AGILIDAD <span class="stat-val" id="stat-agi">10</span> <div class="train-bar"><div class="train-fill" id="t-agi"></div></div></div>
            </div>
            <div id="dmg-math" style="margin-top:15px; background:#1a1a1a; color:#0f0; padding:15px; border-radius:5px; font-family: monospace;">
                --- AN√ÅLISIS DE COMBATE ---<br>Selecciona un enemigo para calcular...
            </div>
            <div style="margin-top:10px;">
                <b>T√çTULO ACTIVO:</b> <span id="active-title" style="color:var(--gold)">Ninguno</span>
            </div>
        </div>

        <div id="tab-inv" class="view">
            <div class="guide-text"><b>Orientaci√≥n:</b> Tienes dos mochilas. La de <b>Loot</b> guarda lo que recojas. La <b>Personal</b> es para tu equipo. Puedes arrastrar o tirar items.</div>
            
            <div class="inv-header">BACKPACK PERSONAL <span>Cap: 16</span></div>
            <div class="grid" id="grid-personal"></div>
            
            <div class="inv-header" style="background:#555">MOCHILA DE LOOT <span>Cap: 16</span></div>
            <div class="grid" id="grid-loot"></div>
        </div>

        <div id="tab-diario" class="view">
            <div class="guide-text"><b>Bestiario Mundial:</b> Listado de criaturas de Nivel 1 a 2000. Derrotarlos te otorga T√≠tulos y misiones diarias.</div>
            <div id="monster-list"></div>
        </div>

        <div id="tab-config" class="view">
            <div class="guide-text">Configura tu experiencia visual y de sonido.</div>
            <button onclick="location.reload()" style="width:100%; padding:20px; background:#a44; color:white; font-weight:bold; border:4px solid #000;">SALIR AL MEN√ö PRINCIPAL</button>
        </div>
    </div>

    <div id="game-ui">
        <button class="action-btn" style="background:#a44; color:white;" onclick="playerAttack()">ATK</button>
        <button class="action-btn" onclick="toggleMenu()">MEN√ö</button>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    let p = {
        clase: '', lvl: 1, exp: 0, gold: 0,
        hp: 100, mHp: 100, mp: 50, mMp: 50,
        x: 2500, y: 2500, target: null,
        stats: { str: 10, mag: 10, def: 10, agi: 10 },
        train: { str: 0, mag: 0, def: 0, agi: 0 },
        titles: [], activeTitle: null
    };

    let mobs = [], active = false, move = {x:0, y:0};

    function startGame(cl) {
        p.clase = cl;
        document.getElementById('setup').style.display = 'none';
        document.getElementById('hud').style.display = 'block';
        document.getElementById('game-ui').style.display = 'flex';
        initGrids();
        initBestiary();
        spawnMobs();
        active = true;
        updateUI();
        loop();
    }

    function initGrids() {
        const gp = document.getElementById('grid-personal');
        const gl = document.getElementById('grid-loot');
        for(let i=0; i<16; i++) {
            gp.innerHTML += `<div class="slot" onclick="alert('Item Personal')"></div>`;
            gl.innerHTML += `<div class="slot" onclick="alert('Item de Loot')"></div>`;
        }
    }

    function initBestiary() {
        const ml = document.getElementById('monster-list');
        const data = [
            {n: "Gelatina de Cristal", t: "TIER 1", l: "1-10", c: "white"},
            {n: "Guerrero Esmeralda", t: "TIER 2", l: "11-50", c: "yellow"},
            {n: "El Soberano", t: "TIER 6", l: "1500-2000", c: "#f0f"}
        ];
        data.forEach(m => {
            ml.innerHTML += `<div style="padding:10px; border-bottom:1px solid #000; color:${m.c}"><b>${m.n}</b> - ${m.t} (Nivel ${m.l})</div>`;
        });
    }

    function spawnMobs() {
        for(let i=0; i<20; i++) {
            mobs.push({ id: i, x: p.x + (Math.random()*600-300), y: p.y + (Math.random()*600-300), hp: 150, max: 150, lvl: 5 });
        }
    }

    function toggleMenu() {
        const m = document.getElementById('menu-container');
        m.style.display = (m.style.display === 'flex' ? 'none' : 'flex');
        if(m.style.display === 'flex') refreshStats();
    }

    function openTab(evt, tabName) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');
    }

    function refreshStats() {
        ['str','mag','def','agi'].forEach(s => {
            document.getElementById('stat-'+s).innerText = p.stats[s];
            document.getElementById('t-'+s).style.width = (p.train[s] / (p.stats[s] * 10)) * 100 + "%";
        });
        
        const math = document.getElementById('dmg-math');
        if(p.target) {
            let myDmg = p.stats.str * 2;
            let hits = Math.ceil(p.target.hp / myDmg);
            math.innerHTML = `AN√ÅLISIS DE COMBATE:<br>Enemigo: Mob Lv.${p.target.lvl}<br>Tu Da√±o: ${myDmg}<br>Vida Mob: ${p.target.hp}<br>Golpes necesarios: ${hits}`;
        } else {
            math.innerHTML = "Selecciona un enemigo para analizar...";
        }
    }

    function playerAttack() {
        if(!p.target) return;
        let d = p.stats.str * 2 + Math.floor(Math.random()*10);
        p.target.hp -= d;
        showDmg(p.target.x, p.target.y, d, "white");
        
        // ENTRENAMIENTO CONSTANTE
        p.train.str += 1;
        if(p.train.str >= p.stats.str * 10) { p.stats.str++; p.train.str = 0; }

        if(p.target.hp <= 0) {
            p.gold += 25; p.exp += 100;
            mobs = mobs.filter(m => m.id !== p.target.id);
            p.target = null;
            updateUI();
        }
    }

    function showDmg(x, y, v, c) {
        const div = document.createElement('div');
        div.className = 'dmg-num';
        div.style.left = (x - (p.x - canvas.width/2)) + 'px';
        div.style.top = (y - (p.y - canvas.height/2)) + 'px';
        div.style.color = c; div.innerText = v;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 800);
    }

    function updateUI() {
        document.getElementById('p-header').innerText = p.clase + " ADVENTURER LV." + p.lvl;
        document.getElementById('hp-txt').innerText = p.hp + "/" + p.mHp;
        document.getElementById('hp-f').style.width = (p.hp/p.mHp)*100 + "%";
        document.getElementById('gold-hud').innerText = "üí∞ " + String(p.gold).padStart(4, '0');
    }

    function loop() {
        if(!active) return;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        let cx = p.x - canvas.width/2, cy = p.y - canvas.height/2;
        ctx.save(); ctx.translate(-cx, -cy);
        ctx.fillStyle = "#111"; ctx.fillRect(cx, cy, canvas.width, canvas.height);

        mobs.forEach(m => {
            ctx.fillStyle = "red"; ctx.fillRect(m.x-20, m.y-20, 40, 40);
            if(p.target === m) {
                ctx.strokeStyle = "red"; ctx.lineWidth = 3;
                ctx.beginPath(); ctx.arc(m.x, m.y, 35, 0, 7); ctx.stroke();
            }
        });

        ctx.fillStyle = "cyan"; ctx.fillRect(p.x-25, p.y-25, 50, 50);
        ctx.restore();
        requestAnimationFrame(loop);
    }

    canvas.addEventListener('touchstart', (e) => {
        let tx = e.touches[0].clientX + (p.x - canvas.width/2);
        let ty = e.touches[0].clientY + (p.y - canvas.height/2);
        p.target = null;
        mobs.forEach(m => { if(Math.hypot(tx-m.x, ty-m.y) < 50) p.target = m; });
    });

    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
</script>
</body>
</html>
