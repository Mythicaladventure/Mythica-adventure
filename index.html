<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mythica - Retro Tech Edition</title>
    <style>
        :root { 
            --gold: #d4af37; --health: #ff3e3e; --mana: #3e93ff; --exp: #4caf50;
            --beige: #e5d3b3; --dark: #1a1a1a; --glow: rgba(255, 255, 255, 0.4);
        }
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Courier New', monospace; }
        
        /* PANTALLA DE INICIO RETRO */
        #setup { position: absolute; inset: 0; background: var(--dark); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .card { 
            background: var(--beige); border: 3px solid #000; padding: 20px; width: 160px; text-align: center; 
            margin: 10px; cursor: pointer; color: #000; font-weight: bold; 
            box-shadow: 0 0 15px var(--glow); transition: 0.2s;
        }
        .card:active { transform: scale(0.95); box-shadow: 0 0 5px var(--glow); }

        /* HUD SUPERIOR IZQUIERDO (REFINADO) */
        #hud { 
            position: absolute; top: 15px; left: 15px; background: var(--beige); 
            padding: 10px; border: 3px solid var(--dark); border-radius: 2px;
            box-shadow: 0 0 10px var(--glow); z-index: 10;
        }
        .hud-label { color: #000; font-size: 11px; font-weight: bold; margin-bottom: 2px; }
        .bar { 
            width: 180px; height: 14px; background: #333; border: 2px solid #000; 
            margin-bottom: 6px; position: relative;
        }
        .fill { height: 100%; position: relative; }
        .glow-effect { position: absolute; top:0; left:0; right:0; bottom:0; box-shadow: inset 0 0 8px rgba(255,255,255,0.5); }
        
        /* BOTONES DE ACCI√ìN RETRO-TECH */
        .actions { position: absolute; bottom: 30px; right: 30px; display: grid; grid-template-columns: repeat(2, 85px); gap: 15px; }
        .btn { 
            width: 85px; height: 85px; background: var(--beige); border: 3px solid var(--dark); 
            border-radius: 8px; display: flex; align-items: center; justify-content: center; 
            font-size: 13px; font-weight: bold; color: #fff; text-shadow: 2px 2px #000;
            box-shadow: 0 0 10px var(--glow), inset 0 0 10px rgba(0,0,0,0.2);
        }
        .btn:active { box-shadow: 0 0 2px var(--glow); transform: translateY(2px); }

        /* JOYSTICK TECH */
        #joy { position: absolute; bottom: 45px; left: 45px; width: 130px; height: 130px; background: rgba(229, 211, 179, 0.1); border-radius: 50%; border: 2px solid var(--beige); }
        #stick { position: absolute; top: 40px; left: 40px; width: 50px; height: 50px; background: var(--beige); border-radius: 50%; box-shadow: 0 0 15px var(--glow); }

        /* MEN√ö INTELIGENTE */
        #menu-ui { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; max-width: 400px; background: var(--beige); border: 4px solid var(--dark);
            padding: 20px; color: #000; display: none; z-index: 100;
        }
        .close-btn { float: right; cursor: pointer; font-weight: bold; }

        #chat { position: absolute; bottom: 150px; left: 15px; width: 200px; height: 80px; font-size: 10px; color: #fff; text-shadow: 1px 1px #000; pointer-events: none; }
    </style>
</head>
<body>

    <div id="setup">
        <h1 style="color: var(--beige); text-shadow: 0 0 20px var(--glow);">MYTHICA ONLINE</h1>
        <div style="display: flex; flex-wrap: wrap; justify-content: center;">
            <div class="card" onclick="start('WARRIOR')">GUERRERO</div>
            <div class="card" onclick="start('MAGE')">MAGO</div>
            <div class="card" onclick="start('ARCHER')">ARQUERO</div>
            <div class="card" onclick="start('HEALER')">SANADOR</div>
        </div>
    </div>

    <div id="hud" style="display:none">
        <div class="hud-label" id="p-name">HERO LV. 1</div>
        <div class="bar"><div id="hp-f" class="fill" style="background:var(--health); width:100%"><div class="glow-effect"></div></div></div>
        <div class="bar"><div id="mp-f" class="fill" style="background:var(--mana); width:100%"><div class="glow-effect"></div></div></div>
        <div class="bar" style="height:6px"><div id="ex-f" class="fill" style="background:var(--exp); width:0%"></div></div>
        <div style="color: #000; font-size: 12px; font-weight: bold;" id="gold-txt">üí∞ 0000</div>
    </div>

    <div id="menu-ui">
        <span class="close-btn" onclick="toggleMenu()">[X]</span>
        <h3>ESTAD√çSTICAS</h3>
        <hr border="1">
        <div id="stats-content"></div>
    </div>

    <div id="chat"></div>
    <canvas id="game"></canvas>
    
    <div id="joy" style="display:none"><div id="stick"></div></div>
    
    <div class="actions" id="btns" style="display:none">
        <div class="btn" style="background: #a33;" onclick="tryAttack()">ATAQUE</div>
        <div class="btn" style="background: #33a;" onclick="trySpell()">PODER</div>
        <div class="btn" style="background: #3a3;" onclick="toggleMenu()">ITEMS</div>
        <div class="btn" style="background: #888;">MEN√ö</div>
    </div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    // TORRE DE C√ÅLCULOS
    const CLASSES = {
        WARRIOR: { name: "Guerrero", hpIn: 350, hpL: 80, mpIn: 60, mpL: 15, spd: 4.8, dmg: 35 },
        MAGE:    { name: "Mago", hpIn: 190, hpL: 35, mpIn: 320, mpL: 90, spd: 4.2, dmg: 60 },
        ARCHER:  { name: "Arquero", hpIn: 270, hpL: 55, mpIn: 130, mpL: 40, spd: 5.8, dmg: 45 },
        HEALER:  { name: "Sanador", hpIn: 240, hpL: 45, mpIn: 260, mpL: 70, spd: 4.5, dmg: 25 }
    };

    let p = { x: 2000, y: 2000, lvl: 1, exp: 0, gold: 0, class: 'WARRIOR', target: null };
    let obstacles = [];
    let mobs = [];
    let world = { w: 5000, h: 5000 };

    const imgP = new Image(); imgP.src = 'player.png';
    const imgF = new Image(); imgF.src = 'floor1.png';
    const imgE = new Image(); imgE.src = 'floor2.png';

    function start(cl) {
        p.class = cl;
        const c = CLASSES[cl];
        p.hp = p.maxHp = c.hpIn;
        p.mp = p.maxMp = c.mpIn;
        p.spd = c.spd;
        document.getElementById('setup').style.display = 'none';
        ['hud','joy','btns'].forEach(i => document.getElementById(i).style.display = 'block');
        generateMap();
        for(let i=0; i<30; i++) spawnMob();
        loop();
    }

    function toggleMenu() {
        const m = document.getElementById('menu-ui');
        const isVisible = m.style.display === 'block';
        m.style.display = isVisible ? 'none' : 'block';
        if(!isVisible) {
            document.getElementById('stats-content').innerHTML = `
                <p>Clase: ${CLASSES[p.class].name}</p>
                <p>Nivel: ${p.lvl}</p>
                <p>Oro: ${p.gold}</p>
                <p>Ataque: ${CLASSES[p.class].dmg + (p.lvl * 2)}</p>
            `;
        }
    }

    function generateMap() {
        for(let i=0; i<80; i++) obstacles.push({ x: Math.random()*world.w, y: Math.random()*world.h, w: 80, h: 80 });
    }

    function spawnMob() {
        mobs.push({ x: Math.random()*world.w, y: Math.random()*world.h, hp: 120, max: 120, d: false });
    }

    function updateHUD() {
        document.getElementById('p-name').innerText = `${p.class} LV. ${p.lvl}`;
        document.getElementById('hp-f').style.width = (p.hp/p.maxHp)*100 + "%";
        document.getElementById('mp-f').style.width = (p.mp/p.maxMp)*100 + "%";
        document.getElementById('ex-f').style.width = (p.exp/(p.lvl*300))*100 + "%";
        document.getElementById('gold-txt').innerText = `üí∞ ${String(p.gold).padStart(4, '0')}`;
    }

    function tryAttack() {
        mobs.forEach(m => {
            if(!m.d && Math.hypot(p.x - m.x, p.y - m.y) < 100) {
                m.hp -= CLASSES[p.class].dmg;
                if(m.hp <= 0) { m.d = true; p.exp += 100; p.gold += 15; checkLvl(); setTimeout(spawnMob, 5000); }
            }
        });
        updateHUD();
    }

    function checkLvl() {
        if(p.exp >= p.lvl * 300) { 
            p.lvl++; p.exp = 0; 
            p.maxHp += CLASSES[p.class].hpL;
            p.hp = p.maxHp;
        }
    }

    // Joystick 
    let joyMove = { x: 0, y: 0 };
    const jA = document.getElementById('joy');
    const jS = document.getElementById('stick');
    jA.ontouchmove = (e) => {
        const r = jA.getBoundingClientRect();
        let x = e.touches[0].clientX - (r.left + 65), y = e.touches[0].clientY - (r.top + 65);
        let d = Math.hypot(x,y); if(d > 45) { x *= 45/d; y *= 45/d; }
        jS.style.transform = `translate(${x}px, ${y}px)`;
        joyMove = { x: x/45, y: y/45 };
    };
    jA.ontouchend = () => { joyMove = { x: 0, y: 0 }; jS.style.transform = 'translate(0,0)'; };

    function loop() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        p.x += joyMove.x * p.spd; p.y += joyMove.y * p.spd;
        let cx = p.x - canvas.width/2, cy = p.y - canvas.height/2;
        ctx.save(); ctx.translate(-cx, -cy);
        
        if(imgF.complete) {
            for(let i=Math.floor(cx/40)*40; i<cx+canvas.width; i+=40) 
            for(let j=Math.floor(cy/40)*40; j<cy+canvas.height; j+=40) ctx.drawImage(imgF, i, j, 41, 41);
        }

        obstacles.forEach(o => {
            ctx.fillStyle = "#3e2723"; ctx.fillRect(o.x, o.y, o.w, o.h);
            ctx.strokeStyle = var(--beige); ctx.strokeRect(o.x, o.y, o.w, o.h);
        });

        mobs.forEach(m => {
            if(m.d) return;
            ctx.drawImage(imgE, m.x-20, m.y-20, 40, 40);
            ctx.fillStyle = "red"; ctx.fillRect(m.x-15, m.y-25, (m.hp/m.max)*30, 4);
        });

        ctx.drawImage(imgP, p.x-25, p.y-25, 50, 50);
        ctx.restore(); requestAnimationFrame(loop);
    }

    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
</script>
</body>
</html>
