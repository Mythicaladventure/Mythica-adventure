<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lawl Online - Genesis S8N Engine</title>
    <style>
        :root {
            --ui-bg: rgba(10, 10, 15, 0.98);
            --gold: #f1c40f; --hp: #e74c3c; --mp: #3498db; --exp: #2ecc71;
        }
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Tahoma', sans-serif; color: white; user-select: none; }
        #wrapper { position: relative; width: 800px; height: 600px; margin: auto; top: 50vh; transform: translateY(-50%); border: 3px solid #222; }
        
        canvas { position: absolute; top: 0; left: 0; image-rendering: pixelated; }
        
        /* UI OVERLAYS */
        .gui { position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        .win { position: absolute; background: var(--ui-bg); border: 2px solid var(--gold); padding: 12px; display: none; pointer-events: all; box-shadow: 0 0 20px #000; }
        
        /* HUD SUPERIOR */
        #hud { top: 20px; left: 20px; width: 280px; background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid #444; }
        .bar { height: 14px; background: #111; border: 1px solid #333; margin-top: 5px; position: relative; overflow: hidden; }
        .fill { height: 100%; transition: width 0.3s; }
        .btxt { position: absolute; width: 100%; text-align: center; font-size: 9px; font-weight: bold; top: 0; line-height: 14px; }

        /* INVENTARIO Y QUESTS */
        #inv { top: 120px; right: 20px; width: 180px; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 10px; }
        .slot { width: 38px; height: 38px; background: #1a1a1a; border: 1px solid #444; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; }
        
        #quests { top: 120px; left: 20px; width: 200px; }
        .q-item { font-size: 11px; color: #bbb; margin-bottom: 5px; border-left: 2px solid var(--exp); padding-left: 5px; }

        /* CHAT Y SKILLS */
        #chat-box { position: absolute; bottom: 100px; left: 20px; width: 300px; }
        #log { height: 120px; background: rgba(0,0,0,0.7); overflow-y: auto; padding: 5px; font-size: 12px; border: 1px solid #333; }
        #chat-in { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 5px; outline: none; box-sizing: border-box; }

        #skill-bar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; }
        .sk { width: 50px; height: 50px; background: #000; border: 2px solid var(--gold); display: flex; align-items: center; justify-content: center; font-size: 24px; position: relative; cursor: pointer; }
        .cd { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); height: 0%; transition: height 0.1s; }

        /* NOTIFICACIONES */
        #notif { position: absolute; top: 20%; width: 100%; text-align: center; font-size: 30px; font-weight: bold; color: var(--gold); text-shadow: 2px 2px #000; pointer-events: none; }
    </style>
</head>
<body>

<div id="wrapper">
    <canvas id="c_bg"></canvas>
    <canvas id="c_main"></canvas>
    <canvas id="c_fx"></canvas>
    <canvas id="c_light" style="mix-blend-mode: multiply;"></canvas>

    <div class="gui">
        <div id="hud">
            <div style="color:var(--gold); font-weight:bold; font-size:14px;">S8N_SUPREME <span style="float:right; font-size:10px;">LVL 99</span></div>
            <div class="bar"><div id="hp-f" class="fill" style="background:var(--hp); width:100%;"></div><div class="btxt">HEALTH</div></div>
            <div class="bar"><div id="mp-f" class="fill" style="background:var(--mp); width:100%;"></div><div class="btxt">MANA</div></div>
            <div class="bar" style="height:4px;"><div id="ex-f" class="fill" style="background:var(--exp); width:40%;"></div></div>
        </div>

        <div id="inv" class="win">
            <div style="font-size:12px; color:var(--gold);">BACKPACK (I)</div>
            <div class="grid" id="inv-g"></div>
        </div>

        <div id="quests" class="win">
            <div style="font-size:12px; color:var(--gold);">QUESTS (Q)</div>
            <div class="q-item"><b>Dragon Slayer</b><br>Hunt the Ancient Wyrm</div>
            <div class="q-item"><b>Soul Collector</b><br>Gather 5/10 Souls</div>
        </div>

        <div id="chat-box">
            <div id="log"></div>
            <input type="text" id="chat-in" placeholder="Press Enter...">
        </div>

        <div id="skill-bar">
            <div class="sk" onclick="useS(0)">üî•<div id="cd0" class="cd"></div></div>
            <div class="sk" onclick="useS(1)">‚ö°<div id="cd1" class="cd"></div></div>
            <div class="sk" onclick="useS(2)">üõ°Ô∏è<div id="cd2" class="cd"></div></div>
            <div class="sk" onclick="useS(3)">ü©∏<div id="cd3" class="cd"></div></div>
        </div>

        <div id="notif"></div>
    </div>
</div>

<script>
/**
 * LAWL OMNI-ENGINE S8N
 * INTEGRA: ILUMINACI√ìN, Y-SORTING, PART√çCULAS, CLIMA, IA, CHAT, SISTEMA DE CAPAS
 */
const W = 800, H = 600, T = 32;
const ctxs = {};
['c_bg', 'c_main', 'c_fx', 'c_light'].forEach(id => ctxs[id] = document.getElementById(id).getContext('2d'));
Object.values(ctxs).forEach(c => { c.canvas.width = W; c.canvas.height = H; });

const world = {
    tiles: [], mobs: [], items: [], fx: [], lights: [],
    size: 100, time: 0, shake: 0
};

const player = {
    x: 50*T, y: 50*T, tx: 50*T, ty: 50*T,
    speed: 4, hp: 100, mp: 100, name: "S8N_HERO",
    moving: false, bubble: "", bTime: 0
};

// 1. GENERACI√ìN TOTAL DEL MUNDO
for(let y=0; y<world.size; y++) {
    world.tiles[y] = [];
    for(let x=0; x<world.size; x++) {
        let r = Math.random();
        let type = (x==0 || y==0 || x==world.size-1 || y==world.size-1) ? 1 : (r > 0.98 ? 1 : (r < 0.04 ? 2 : 0));
        world.tiles[y][x] = type;
        if(type === 0 && Math.random() > 0.99) world.mobs.push({x: x*T, y: y*T, hp: 100, max: 100, name: "Void Stalker"});
    }
}

function useS(i) {
    const cd = document.getElementById('cd'+i);
    if(cd.style.height === "100%") return;
    cd.style.height = "100%";
    world.shake = 15;
    spawnFX(player.x+16, player.y+16, i==0?'#f39c12':'#3498db', 20);
    setTimeout(() => cd.style.height = "0%", 2000);
}

function spawnFX(x, y, col, amt) {
    for(let i=0; i<amt; i++) {
        world.fx.push({x, y, vx: (Math.random()-0.5)*6, vy: (Math.random()-0.5)*6, life: 40, col});
    }
}

function update() {
    world.time += 0.005;
    if(world.shake > 0) world.shake *= 0.9;

    // Movimiento (L√≥gica Lawl Core)
    if(!player.moving) {
        let dx = 0, dy = 0;
        const k = keys;
        if(k['w']) dy = -1; else if(k['s']) dy = 1;
        else if(k['a']) dx = -1; else if(k['d']) dx = 1;

        if(dx !== 0 || dy !== 0) {
            let nx = (player.x/T)+dx, ny = (player.y/T)+dy;
            if(world.tiles[ny] && world.tiles[ny][nx] === 0) {
                player.tx = nx*T; player.ty = ny*T; player.moving = true;
            }
        }
    } else {
        if(player.x < player.tx) player.x += player.speed;
        else if(player.x > player.tx) player.x -= player.speed;
        if(player.y < player.ty) player.y += player.speed;
        else if(player.y > player.ty) player.y -= player.speed;
        if(player.x == player.tx && player.y == player.ty) player.moving = false;
    }

    // IA y Part√≠culas
    world.mobs.forEach(m => {
        if(Math.hypot(player.x-m.x, player.y-m.y) < 150) {
            m.x += (player.x-m.x)*0.01; m.y += (player.y-m.y)*0.01;
        }
    });
    world.fx.forEach((f, i) => {
        f.x += f.vx; f.y += f.vy; f.life--;
        if(f.life <= 0) world.fx.splice(i, 1);
    });
    if(player.bTime > 0) player.bTime--;
}

function draw() {
    const camX = player.x - W/2 + (Math.random()*world.shake);
    const camY = player.y - H/2 + (Math.random()*world.shake);

    Object.values(ctxs).forEach(c => c.clearRect(0,0,W,H));

    // Capa 1: Background
    ctxs.c_bg.save();
    ctxs.c_bg.translate(-camX, -camY);
    for(let y = Math.floor(camY/T); y < Math.ceil((camY+H)/T); y++) {
        for(let x = Math.floor(camX/T); x < Math.ceil((camX+W)/T); x++) {
            if(!world.tiles[y] || world.tiles[y][x] === undefined) continue;
            let t = world.tiles[y][x];
            ctxs.c_bg.fillStyle = t==0 ? "#111a11" : (t==1 ? "#222" : "#0a1420");
            ctxs.c_bg.fillRect(x*T, y*T, T, T);
            if(t==2) { // Shaders de agua
                ctxs.c_bg.fillStyle = "rgba(255,255,255,0.05)";
                ctxs.c_bg.fillRect(x*T + Math.sin(world.time + x)*4, y*T + Math.cos(world.time + y)*4, 4, 4);
            }
        }
    }
    ctxs.c_bg.restore();

    // Capa 2: Entidades (Depth Sorting Pro)
    ctxs.c_main.save();
    ctxs.c_main.translate(-camX, -camY);
    const render = [...world.mobs, player].sort((a,b) => a.y - b.y);
    render.forEach(e => {
        if(e.name === player.name) {
            ctxs.c_main.fillStyle = "gold"; ctxs.c_main.fillRect(e.x+4, e.y+4, 24, 24);
            ctxs.c_main.fillStyle = "white"; ctxs.c_main.font = "bold 10px Arial";
            ctxs.c_main.textAlign = "center"; ctxs.c_main.fillText(e.name, e.x+16, e.y-10);
            if(player.bTime > 0) {
                ctxs.c_main.fillStyle = "white"; ctxs.c_main.fillRect(e.x-20, e.y-40, 70, 15);
                ctxs.c_main.fillStyle = "black"; ctxs.c_main.fillText(player.bubble, e.x+15, e.y-29);
            }
        } else {
            ctxs.c_main.fillStyle = "#c0392b"; ctxs.c_main.fillRect(e.x+6, e.y+6, 20, 20);
            ctxs.c_main.fillStyle = "rgba(255,0,0,0.5)"; ctxs.c_main.fillRect(e.x, e.y-5, (e.hp/100)*32, 3);
        }
    });
    ctxs.c_main.restore();

    // Capa 3: Luces y Clima
    const night = Math.abs(Math.sin(world.time*0.1)) * 0.8;
    ctxs.c_light.fillStyle = `rgba(0,0,20,${0.4 + night})`;
    ctxs.c_light.fillRect(0,0,W,H);
    
    let g = ctxs.c_light.createRadialGradient(400,300, 0, 400,300, 200);
    g.addColorStop(0, "rgba(255,255,255,1)"); g.addColorStop(1, "rgba(0,0,0,0)");
    ctxs.c_light.globalCompositeOperation = 'destination-out';
    ctxs.c_light.fillStyle = g;
    ctxs.c_light.beginPath(); ctxs.c_light.arc(400,300, 200, 0, Math.PI*2); ctxs.c_light.fill();
    ctxs.c_light.globalCompositeOperation = 'source-over';

    // FX Part√≠culas
    ctxs.c_fx.save();
    ctxs.c_fx.translate(-camX, -camY);
    world.fx.forEach(f => {
        ctxs.c_fx.fillStyle = f.col; ctxs.c_fx.globalAlpha = f.life/40;
        ctxs.c_fx.fillRect(f.x, f.y, 3, 3);
    });
    ctxs.c_fx.restore();
}

// INPUTS
const keys = {};
window.onkeydown = e => {
    keys[e.key.toLowerCase()] = true;
    if(e.key === 'i') toggle('inv');
    if(e.key === 'q') toggle('quests');
    if(e.key === 'Enter') {
        const i = document.getElementById('chat-in');
        if(document.activeElement === i && i.value) {
            player.bubble = i.value; player.bTime = 180;
            document.getElementById('log').innerHTML += `<div><b>${player.name}:</b> ${i.value}</div>`;
            i.value = ""; i.blur();
        } else i.focus();
    }
};
window.onkeyup = e => keys[e.key.toLowerCase()] = false;
function toggle(id) { let el = document.getElementById(id); el.style.display = el.style.display==='block'?'none':'block'; }

// Init Inv Slots
for(let i=0; i<16; i++) {
    const s = document.createElement('div'); s.className = 'slot';
    if(i==0) s.innerText = "üó°Ô∏è"; if(i==1) s.innerText = "üçé";
    document.getElementById('inv-g').appendChild(s);
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
