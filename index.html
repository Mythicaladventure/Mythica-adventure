<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mythical Adventure - MMORPG</title>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://unpkg.com/colyseus.js@^0.15.0/dist/colyseus.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser3-rex-plugins@1.1.84/dist/rexvirtualjoystickplugin.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* === ESTILOS VISUALES (Sin cambios, pero necesarios) === */
        * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-user-select: none; }
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; font-family: 'Lato', sans-serif; color: white; }

        /* PANTALLA DE LOGIN */
        #login-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1a0b00 0%, #000000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5000;
        }
        .game-logo { font-family: 'Cinzel', serif; color: #ffcc00; text-shadow: 0 0 15px #ff6600; font-size: 3rem; margin-bottom: 20px; text-align: center; }
        .login-container { background: rgba(20,20,20,0.9); border: 1px solid #444; border-top: 2px solid #ffcc00; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 15px; }
        input { background: #111; border: 1px solid #555; color: #fff; padding: 12px; font-size: 16px; border-radius: 4px; text-align: center; width: 100%; font-family: 'Cinzel', serif; }
        
        .class-selector { display: flex; gap: 8px; justify-content: center; }
        .class-card { width: 70px; height: 90px; background: #222; border: 1px solid #444; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .class-card.selected { border-color: #ffcc00; background: linear-gradient(180deg, #3a2a00, #1a1a00); box-shadow: 0 0 10px #ffcc00aa; }
        .class-icon { font-size: 28px; margin-bottom: 5px; }
        .class-name { font-size: 9px; color: #aaa; text-transform: uppercase; font-weight: bold; }

        #start-btn { background: linear-gradient(90deg, #880000, #cc0000); color: white; border: none; padding: 15px; font-size: 16px; font-weight: bold; border-radius: 4px; cursor: pointer; font-family: 'Cinzel', serif; width: 100%; }

        /* HUD JUEGO */
        #game-ui { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        #game-ui > * { pointer-events: auto; }

        .player-profile { position: absolute; top: 10px; left: 10px; display: flex; gap: 8px; background: rgba(0,0,0,0.6); padding: 5px; border-radius: 30px; border: 1px solid #444; }
        .avatar-frame { width: 48px; height: 48px; border-radius: 50%; border: 2px solid #ffd700; background: #111; overflow: hidden; }
        .avatar-frame img { width: 100%; height: 100%; }
        .bars { display: flex; flex-direction: column; gap: 3px; width: 120px; justify-content: center; }
        .bar-container { height: 10px; background: #222; border: 1px solid #555; position: relative; border-radius: 3px; }
        .bar-fill { height: 100%; transition: width 0.3s; }
        .hp-fill { background: #d32f2f; } .mp-fill { background: #1976d2; }
        .bar-text { position: absolute; width: 100%; text-align: center; font-size: 8px; line-height: 10px; text-shadow: 1px 1px 0 #000; }

        /* CHAT */
        #chat-system { position: absolute; bottom: 90px; left: 15px; width: 280px; display: flex; flex-direction: column; gap: 5px; pointer-events: none; }
        #chat-log { height: 100px; overflow-y: auto; background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%); padding: 5px; display: flex; flex-direction: column-reverse; pointer-events: auto; font-size: 11px; text-shadow: 1px 1px 0 #000; }
        .chat-input-row { display: flex; gap: 5px; pointer-events: auto; }
        #chat-input { background: rgba(0,0,0,0.6); padding: 5px; color: white; border: 1px solid #555; flex-grow: 1; font-family: 'Lato', sans-serif; }
        .msg-sys { color: #ffff00; } .msg-player { color: #fff; }

        /* BOTONES */
        .action-bar { position: absolute; bottom: 20px; right: 20px; display: flex; gap: 10px; align-items: flex-end; }
        .btn { width: 55px; height: 55px; border-radius: 12px; border: 2px solid #666; background: radial-gradient(circle, #333 0%, #111 100%); color: white; font-size: 24px; display: flex; align-items: center; justify-content: center; }
        .btn:active { transform: scale(0.95); border-color: #ffd700; }
        .attack-btn { width: 75px; height: 75px; background: radial-gradient(circle, #550000 0%, #220000 100%); border-color: #aa0000; }
    </style>
</head>
<body>
    <div id="game-container"></div>

    <div id="login-screen">
        <div class="game-logo">MYTHICAL<br>ADVENTURE</div>
        <div class="login-container">
            <input type="text" id="username-input" placeholder="Nombre del H√©roe" maxlength="12">
            
            <div class="class-selector">
                <div class="class-card selected" onclick="selectClass('knight', this)"><div class="class-icon">üõ°Ô∏è</div><div class="class-name">Knight</div></div>
                <div class="class-card" onclick="selectClass('mage', this)"><div class="class-icon">üî•</div><div class="class-name">Mage</div></div>
                <div class="class-card" onclick="selectClass('paladin', this)"><div class="class-icon">üèπ</div><div class="class-name">Paladin</div></div>
                <div class="class-card" onclick="selectClass('healer', this)"><div class="class-icon">‚ú®</div><div class="class-name">Healer</div></div>
            </div>

            <button id="start-btn" onclick="startGame()">JUGAR AHORA</button>
        </div>
    </div>

    <div id="game-ui">
        <div class="player-profile">
            <div class="avatar-frame"><img src="client/assets/player.png" onerror="this.src='https://via.placeholder.com/48/333'"></div>
            <div class="bars">
                <div class="bar-container"><div class="bar-text" id="hp-text">100/100</div><div class="bar-fill hp-fill" id="hp-bar" style="width: 100%"></div></div>
                <div class="bar-container"><div class="bar-text" id="mp-text">50/50</div><div class="bar-fill mp-fill" id="mp-bar" style="width: 100%"></div></div>
            </div>
        </div>
        <div id="chat-system">
            <div id="chat-log"><div class="msg-sys">Bienvenido a Mythical Adventure.</div></div>
            <div class="chat-input-row">
                <input type="text" id="chat-input" placeholder="Chat..." onkeydown="if(event.key==='Enter') sendChat()">
                <button class="btn" style="width: 30px; height: 30px; font-size: 14px;" onclick="sendChat()">‚û§</button>
            </div>
        </div>
        <div class="action-bar">
            <button class="btn" onclick="emitAction('HEAL')">üíä</button>
            <button class="btn" onclick="emitAction('SPELL_1')">üî•</button>
            <button class="btn attack-btn" onclick="emitAction('ATTACK')">‚öîÔ∏è</button>
        </div>
    </div>

    <script>
        let selectedClass = 'knight';
        function selectClass(role, el) {
            selectedClass = role;
            document.querySelectorAll('.class-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
        }
        function startGame() {
            const name = document.getElementById('username-input').value.trim();
            if(!name) return alert("¬°Elige un nombre!");
            window.dispatchEvent(new CustomEvent('start-game', { detail: { name, role: selectedClass } }));
        }
        function emitAction(type) { window.dispatchEvent(new CustomEvent('game-action', { detail: type })); }
        function sendChat() {
            const input = document.getElementById('chat-input');
            if(input.value.trim()) {
                window.dispatchEvent(new CustomEvent('game-action', { detail: input.value }));
                addLog(`T√∫: ${input.value}`, 'msg-player');
                input.value = '';
            }
        }
        window.addLog = (msg, type='msg-sys') => {
            const log = document.getElementById('chat-log');
            const div = document.createElement('div'); div.className = type; div.innerText = msg;
            log.prepend(div);
        }
    </script>

    <script src="index.js"></script>
</body>
</html>
