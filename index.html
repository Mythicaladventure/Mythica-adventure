<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mythical Adventure - MMORPG</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* === ESTILOS RPG COMPLETOS === */
        * { box-sizing: border-box; touch-action: none; user-select: none; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; font-family: 'Lato', sans-serif; color: #d4c6a9; }
        #game-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        :root {
            --gold: #d4af37;
            --red: #8a0b0b;
            --dark: #0f0c0c;
        }

        /* --- LOGIN --- */
        #login-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at center, #2e1414 0%, #000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 5000; transition: opacity 0.8s;
        }
        .game-logo {
            font-family: 'Cinzel', serif; font-weight: 900; color: var(--gold);
            font-size: 3rem; text-align: center; margin-bottom: 20px;
            text-shadow: 0 0 15px #ff6600;
        }
        .login-panel {
            background: linear-gradient(135deg, #1a1a1a, #0d0d0d);
            width: 90%; max-width: 400px; padding: 25px; border-radius: 12px;
            border: 2px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        input {
            background: #080808; border: 1px solid #333; color: var(--gold);
            padding: 15px; font-size: 16px; border-radius: 4px; text-align: center; width: 100%;
            font-family: 'Cinzel', serif; margin-bottom: 15px;
        }
        .class-selector { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .class-card {
            width: 65px; height: 85px; background: #222; border: 1px solid #444; border-radius: 6px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;
        }
        .class-card.selected { border: 2px solid var(--gold); background: #3d0000; }
        .class-icon { font-size: 28px; }
        .class-name { font-size: 9px; margin-top: 5px; color: #aaa; }
        
        #start-btn {
            background: linear-gradient(to bottom, #c0392b, #8a0b0b); color: white;
            padding: 15px; width: 100%; border: none; font-family: 'Cinzel', serif; font-size: 18px;
            border-radius: 4px; box-shadow: 0 4px 0 #440000; cursor: pointer;
        }
        #start-btn:active { transform: translateY(4px); box-shadow: none; }

        /* --- HUD (Interfaz de Juego) --- */
        #game-ui { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        #game-ui > * { pointer-events: auto; }

        /* Perfil */
        .player-profile {
            position: absolute; top: 15px; left: 15px; display: flex; align-items: center;
            background: rgba(0,0,0,0.7); padding: 5px 15px 5px 5px; border-radius: 50px;
            border: 1px solid #444; border-left: 3px solid var(--gold);
        }
        .avatar-frame {
            width: 55px; height: 55px; border-radius: 50%; border: 2px solid #555; 
            background: #000; overflow: hidden; margin-right: 10px;
        }
        .bars { display: flex; flex-direction: column; gap: 4px; width: 120px; }
        .bar-container { height: 12px; background: #111; border-radius: 4px; position: relative; border: 1px solid #333; }
        .bar-fill { height: 100%; border-radius: 3px; }
        .hp-fill { background: linear-gradient(to right, #8a0b0b, #d32f2f); }
        .mp-fill { background: linear-gradient(to right, #0b4f8a, #1976d2); }
        .bar-text { position: absolute; width: 100%; text-align: center; font-size: 9px; line-height: 12px; top: 0; color: #fff; }

        /* Men√∫ Lateral Derecho (NUEVO) */
        .sidebar-menu {
            position: absolute; top: 15px; right: 15px; display: flex; flex-direction: column; gap: 10px;
        }
        .side-btn {
            width: 40px; height: 40px; background: rgba(0,0,0,0.8); border: 1px solid #555; border-radius: 6px;
            color: var(--gold); font-size: 20px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .side-btn:active { transform: scale(0.95); background: #333; }

        /* Chat */
        #chat-system {
            position: absolute; bottom: 100px; left: 15px; width: 280px;
        }
        #chat-log {
            height: 100px; overflow-y: auto; background: rgba(0,0,0,0.6); padding: 5px;
            border-radius: 4px; font-size: 11px; margin-bottom: 5px; text-shadow: 1px 1px 0 #000;
            display: flex; flex-direction: column-reverse;
        }
        .chat-input-row { display: flex; gap: 5px; }
        #chat-input { background: rgba(0,0,0,0.6); border: 1px solid #444; padding: 5px; margin: 0; text-align: left; }
        #chat-send { background: #333; color: var(--gold); border: 1px solid #555; width: 30px; }

        /* Botones de Acci√≥n */
        .action-bar {
            position: absolute; bottom: 20px; right: 20px; display: flex; gap: 12px; align-items: flex-end;
        }
        .btn {
            width: 60px; height: 60px; border-radius: 12px; border: 2px solid #555;
            background: radial-gradient(circle, #333, #111); color: #ddd; font-size: 24px;
            box-shadow: 0 4px 0 #000;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .attack-btn {
            width: 85px; height: 85px; background: radial-gradient(circle, #8a0b0b, #400000);
            border-color: #a80000; font-size: 36px; color: var(--gold);
        }
        
    </style>
</head>
<body>
    <div id="game-container"></div>

    <div id="login-screen">
        <div class="game-logo">MYTHICAL<br>ADVENTURE</div>
        <div class="login-panel">
            <input type="text" id="username-input" placeholder="Nombre del H√©roe" maxlength="12">
            <div class="class-selector">
                <div class="class-card selected" onclick="selectClass('knight', this)"><div class="class-icon">üõ°Ô∏è</div><div class="class-name">Knight</div></div>
                <div class="class-card" onclick="selectClass('mage', this)"><div class="class-icon">üî•</div><div class="class-name">Mage</div></div>
                <div class="class-card" onclick="selectClass('paladin', this)"><div class="class-icon">üèπ</div><div class="class-name">Paladin</div></div>
                <div class="class-card" onclick="selectClass('healer', this)"><div class="class-icon">‚ú®</div><div class="class-name">Healer</div></div>
            </div>
            <button id="start-btn" onclick="startGame()">ENTRAR AL MUNDO</button>
        </div>
    </div>

    <div id="game-ui">
        <div class="player-profile">
            <div class="avatar-frame"><img src="client/assets/sprites/otsp_creatures_01.png" id="ui-avatar" style="object-fit: none; object-position: 0 0; width: 100%; height: 100%;"></div>
            <div class="bars">
                <div class="bar-container"><div class="bar-text" id="hp-text">100/100</div><div class="bar-fill hp-fill" id="hp-bar" style="width: 100%"></div></div>
                <div class="bar-container"><div class="bar-text" id="mp-text">50/50</div><div class="bar-fill mp-fill" id="mp-bar" style="width: 100%"></div></div>
            </div>
        </div>

        <div class="sidebar-menu">
            <div class="side-btn">üéí</div> <div class="side-btn">üó∫Ô∏è</div> <div class="side-btn">‚öôÔ∏è</div> </div>

        <div id="chat-system">
            <div id="chat-log"><div style="color:var(--gold);">Has llegado a la Capital.</div></div>
            <div class="chat-input-row"><input type="text" id="chat-input" placeholder="Chat..."><button id="chat-send" onclick="sendChat()">‚û§</button></div>
        </div>

        <div class="action-bar">
            <button class="btn" onclick="emitAction('HEAL')">üíä</button>
            <button class="btn" onclick="emitAction('SPELL_1')">üî•</button>
            <button class="btn attack-btn" onclick="emitAction('ATTACK')">‚öîÔ∏è</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/colyseus.js@0.15.0/dist/colyseus.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser3-rex-plugins@1.1.84/dist/rexvirtualjoystickplugin.min.js"></script>
    
    <script src="client/index.js?v=30000"></script>

    <script>
        let selectedClass = 'knight';
        window.onerror = function(msg) { console.error("Game Error:", msg); };
        function selectClass(cls, el) {
            selectedClass = cls; document.querySelectorAll('.class-card').forEach(c => c.classList.remove('selected')); el.classList.add('selected');
        }
        function startGame() {
            const name = document.getElementById('username-input').value.trim(); if(!name) return;
            const btn = document.getElementById('start-btn'); btn.disabled = true; btn.innerText = "CONECTANDO...";
            window.dispatchEvent(new CustomEvent('start-game', { detail: { name: name, role: selectedClass } }));
            setTimeout(() => { if(btn.disabled && document.getElementById('login-screen').style.display !== 'none') { btn.innerText = "REINTENTAR"; btn.disabled = false; } }, 10000);
        }
        function emitAction(t) { window.dispatchEvent(new CustomEvent('game-action', { detail: t })); }
        function sendChat() {
            const i = document.getElementById('chat-input'); if(i.value.trim()) { 
                window.dispatchEvent(new CustomEvent('game-action', { detail: i.value })); 
                const log = document.getElementById('chat-log'); log.innerHTML = `<div style="color:#aaa;">T√∫: ${i.value}</div>` + log.innerHTML; i.value = ''; 
            }
        }
    </script>
</body>
</html>
