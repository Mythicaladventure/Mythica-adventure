<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mythica Online - Lawl Style</title>
    <style>
        :root { --gold: #ffd700; --health: #ff4757; --mana: #2e86de; --exp: #2ecc71; --ui-bg: rgba(20, 20, 25, 0.95); }
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Courier New', monospace; color: white; }
        
        /* Pantalla de Inicio */
        #setup-screen { position: absolute; inset: 0; background: #050505; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .class-select { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
        .card { background: #1a1a1a; border: 2px solid #333; padding: 15px; width: 140px; text-align: center; border-radius: 8px; transition: 0.3s; }
        .card:active { border-color: var(--gold); background: #222; }

        /* HUD Superior (Stats) */
        #hud { position: absolute; top: 10px; left: 10px; background: var(--ui-bg); padding: 12px; border: 2px solid var(--gold); border-radius: 5px; pointer-events: none; min-width: 160px; }
        .bar { width: 100%; height: 12px; background: #111; border: 1px solid #444; margin: 4px 0; position: relative; }
        .fill { height: 100%; transition: width 0.3s; }
        
        /* Floating Damage */
        .dmg { position: absolute; font-weight: bold; pointer-events: none; animation: floatUp 0.8s ease-out forwards; }
        @keyframes floatUp { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-50px); opacity: 0; } }

        /* Controles */
        #joy-bg { position: absolute; bottom: 50px; left: 50px; width: 120px; height: 120px; background: rgba(255,255,255,0.05); border-radius: 50%; border: 1px solid rgba(255,255,255,0.1); }
        #joy-thumb { position: absolute; top: 35px; left: 35px; width: 50px; height: 50px; background: var(--gold); border-radius: 50%; opacity: 0.5; }
        .actions { position: absolute; bottom: 40px; right: 40px; display: grid; grid-template-columns: repeat(2, 80px); gap: 15px; }
        .btn { width: 80px; height: 80px; background: var(--ui-bg); border: 2px solid var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; box-shadow: 0 4px 0 #8a6d00; }
        .btn:active { transform: translateY(3px); box-shadow: none; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h1 style="color: var(--gold); letter-spacing: 5px;">MYTHICA</h1>
        <p>SELECCIONA TU VOCACIÓN</p>
        <div class="class-select">
            <div class="card" onclick="startGame('WARRIOR')"><h3>GUERRERO</h3><small>Tanque</small></div>
            <div class="card" onclick="startGame('MAGE')"><h3>MAGO</h3><small>Explosivo</small></div>
            <div class="card" onclick="startGame('ARCHER')"><h3>ARQUERO</h3><small>Veloz</small></div>
            <div class="card" onclick="startGame('HEALER')"><h3>SANADOR</h3><small>Soporte</small></div>
        </div>
    </div>

    <div id="hud" style="display:none">
        <div id="info">HERO [Lv 1]</div>
        <div class="bar"><div id="hp-fill" class="fill" style="background:var(--health); width:100%"></div></div>
        <div class="bar"><div id="mp-fill" class="fill" style="background:var(--mana); width:100%"></div></div>
        <div class="bar" style="height:4px"><div id="exp-fill" class="fill" style="background:var(--exp); width:0%"></div></div>
    </div>

    <canvas id="game"></canvas>
    <div id="joy-bg" style="display:none"><div id="joy-thumb"></div></div>
    
    <div class="actions" id="ctrls" style="display:none">
        <div class="btn" style="color:var(--health)" onclick="doAttack()">ATAQUE</div>
        <div class="btn" style="color:var(--mana)" onclick="doSpell()">PODER</div>
        <div class="btn" style="color:#2ecc71">MOCHILA</div>
        <div class="btn" style="color:var(--gold)">MENU</div>
    </div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    // CONFIGURACIÓN DE CLASES (Torre de Cálculos Lawl)
    const CLASSES = {
        WARRIOR: { hpIn: 350, hpLvl: 80, mpIn: 50, mpLvl: 10, speed: 4.5, dmg: 25 },
        MAGE: { hpIn: 180, hpLvl: 35, mpIn: 250, mpLvl: 85, speed: 4, dmg: 45 },
        ARCHER: { hpIn: 250, hpLvl: 55, mpIn: 100, mpLvl: 35, speed: 5.5, dmg: 35 },
        HEALER: { hpIn: 220, hpLvl: 45, mpIn: 200, mpLvl: 65, speed: 4.2, dmg: 20 }
    };

    let p = { 
        x: 1500, y: 1500, lvl: 1, exp: 0, 
        hp: 350, maxHp: 350, mp: 50, maxMp: 50,
        class: 'WARRIOR', dead: false
    };

    let enemies = [];
    let world = { w: 3000, h: 3000 };
    let imgPlayer = new Image(); imgPlayer.src = 'player.png';
    let imgFloor = new Image(); imgFloor.src = 'floor1.png';
    let imgMob = new Image(); imgMob.src = 'floor2.png';

    function startGame(vocation) {
        p.class = vocation;
        const c = CLASSES[vocation];
        p.maxHp = p.hp = c.hpIn;
        p.maxMp = p.mp = c.mpIn;
        document.getElementById('setup-screen').style.display = 'none';
        ['hud','joy-bg','ctrls'].forEach(id => document.getElementById(id).style.display = 'block');
        spawnMobs();
        loop();
    }

    function spawnMobs() {
        for(let i=0; i<20; i++) {
            enemies.push({
                x: Math.random()*world.w, y: Math.random()*world.h,
                hp: 100, maxHp: 100, dead: false
            });
        }
    }

    function doAttack() {
        enemies.forEach(m => {
            let dist = Math.hypot(p.x - m.x, p.y - m.y);
            if(dist < 80 && !m.dead) {
                let d = CLASSES[p.class].dmg + Math.floor(Math.random()*10);
                m.hp -= d;
                showDamage(m.x, m.y, d, "white");
                if(m.hp <= 0) { 
                    m.dead = true; 
                    p.exp += 40; 
                    checkLvl();
                    setTimeout(() => { m.dead = false; m.hp = 100; m.x = Math.random()*world.w; m.y = Math.random()*world.h; }, 5000);
                }
            }
        });
    }

    function checkLvl() {
        let next = p.lvl * 150;
        if(p.exp >= next) {
            p.lvl++; p.exp = 0;
            const c = CLASSES[p.class];
            p.maxHp += c.hpLvl; p.maxMp += c.mpLvl;
            p.hp = p.maxHp; p.mp = p.maxMp;
            showDamage(p.x, p.y, "LEVEL UP!", "gold");
        }
        updateHUD();
    }

    function showDamage(x, y, text, color) {
        const d = document.createElement('div');
        d.className = 'dmg';
        d.style.left = (x - (p.x - canvas.width/2)) + 'px';
        d.style.top = (y - (p.y - canvas.height/2)) + 'px';
        d.style.color = color;
        d.innerText = text;
        document.body.appendChild(d);
        setTimeout(() => d.remove(), 800);
    }

    function updateHUD() {
        document.getElementById('info').innerText = `${p.class} [Lv ${p.lvl}]`;
        document.getElementById('hp-fill').style.width = (p.hp/p.maxHp)*100 + "%";
        document.getElementById('mp-fill').style.width = (p.mp/p.maxMp)*100 + "%";
        document.getElementById('exp-fill').style.width = (p.exp/(p.lvl*150))*100 + "%";
    }

    // Sistema de Movimiento
    let joy = { dx: 0, dy: 0 };
    const jArea = document.getElementById('joy-bg');
    const jThumb = document.getElementById('joy-thumb');
    
    jArea.ontouchmove = (e) => {
        const t = e.touches[0];
        const r = jArea.getBoundingClientRect();
        let x = t.clientX - (r.left + 60);
        let y = t.clientY - (r.top + 60);
        let d = Math.hypot(x, y);
        if(d > 40) { x *= 40/d; y *= 40/d; }
        jThumb.style.transform = `translate(${x}px, ${y}px)`;
        joy = { dx: x/40, dy: y/40 };
    };
    jArea.ontouchend = () => { joy = { dx: 0, dy: 0 }; jThumb.style.transform = 'translate(0,0)'; };

    function loop() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        p.x += joy.dx * CLASSES[p.class].speed;
        p.y += joy.dy * CLASSES[p.class].speed;

        let camX = p.x - canvas.width/2;
        let camY = p.y - canvas.height/2;

        ctx.save();
        ctx.translate(-camX, -camY);

        // Piso
        if(imgFloor.complete) {
            for(let i=0; i<world.w; i+=40) {
                for(let j=0; j<world.h; j+=40) {
                    if(i > camX-40 && i < camX+canvas.width && j > camY-40 && j < camY+canvas.height)
                        ctx.drawImage(imgFloor, i, j, 41, 41);
                }
            }
        }

        // Monstruos IA
        enemies.forEach(m => {
            if(m.dead) return;
            let d = Math.hypot(p.x - m.x, p.y - m.y);
            if(d < 250) { // Persecución
                m.x += (p.x - m.x) * 0.015;
                m.y += (p.y - m.y) * 0.015;
                if(d < 30 && Math.random() < 0.05) { // Ataque mob
                    p.hp -= 5;
                    updateHUD();
                    showDamage(p.x, p.y, 5, "red");
                }
            }
            ctx.drawImage(imgMob, m.x-20, m.y-20, 40, 40);
            ctx.fillStyle = "red"; ctx.fillRect(m.x-15, m.y-25, (m.hp/m.maxHp)*30, 3);
        });

        // Jugador
        ctx.drawImage(imgPlayer, p.x-25, p.y-25, 50, 50);
        
        ctx.restore();
        requestAnimationFrame(loop);
    }

    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
</script>
</body>
</html>
