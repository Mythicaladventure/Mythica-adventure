<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mythica Online: Evolved Engine</title>
    <style>
        :root { 
            --tibia-bg: #3c3c3c; --stone: #5a5a5a; --border: #1a1a1a;
            --gold: #d4af37; --health: #00ff00; --mana: #3e93ff;
            --t1: #ffffff; --t2: #fbff00; --t3: #ff9100; --t4: #ff3c00; --t5: #d400ff; --t6: #00ffff;
        }
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Verdana', sans-serif; color: #e0e0e0; touch-action: none; }
        
        /* PANTALLA DE SELECCI칍N DE CLASE */
        #class-selection {
            position: absolute; inset: 0; background: radial-gradient(circle, #222, #000);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;
        }
        .class-card {
            width: 280px; padding: 20px; margin: 10px; background: var(--stone);
            border: 4px outset #888; border-radius: 12px; text-align: center; cursor: pointer;
            transition: 0.2s; box-shadow: 0 10px 20px #000;
        }
        .class-card:active { transform: scale(0.95); border-style: inset; }

        /* HUD TIBIA STYLE */
        #hud {
            position: absolute; top: 15px; right: 15px; width: 220px;
            background: rgba(40,40,40,0.9); border: 3px outset #777; border-radius: 8px;
            padding: 12px; z-index: 1000; display: none;
        }
        .bar-container { width: 100%; height: 16px; background: #111; border: 1px solid #000; margin: 5px 0; position: relative; }
        .bar-fill { height: 100%; transition: width 0.3s; }
        .bar-txt { position: absolute; width: 100%; text-align: center; font-size: 10px; line-height: 16px; font-weight: bold; color: #fff; text-shadow: 1px 1px #000; }

        /* JOYSTICK */
        #joy { position: absolute; bottom: 50px; left: 50px; width: 110px; height: 110px; background: rgba(0,0,0,0.2); border: 2px solid #666; border-radius: 50%; display: none; }
        #stick { position: absolute; width: 50px; height: 50px; background: #888; border: 3px outset #aaa; border-radius: 50%; top: 27px; left: 27px; }

        /* MEN칔 PROFESIONAL */
        #main-menu {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 92%; height: 85%; background: var(--tibia-bg); border: 5px outset #888;
            border-radius: 15px; display: none; flex-direction: column; z-index: 2000;
            box-shadow: 0 0 40px #000;
        }
        .tabs { display: flex; background: #1a1a1a; height: 50px; border-radius: 10px 10px 0 0; }
        .tab { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; color: #777; cursor: pointer; }
        .tab.active { background: var(--tibia-bg); color: var(--gold); }
        
        .view { flex: 1; padding: 20px; overflow-y: auto; }
        .panel-inset { background: rgba(0,0,0,0.2); border: 2px inset rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin-bottom: 15px; }

        /* BACKPACK GRID */
        .inv-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .slot { aspect-ratio: 1/1; background: #4a4a4a; border: 2px inset #222; border-radius: 6px; }

        /* BOTONES DE ACCI칍N */
        .action-btns { position: absolute; bottom: 40px; right: 40px; display: none; gap: 15px; }
        .btn-round { width: 80px; height: 80px; border-radius: 50%; border: 5px outset #888; background: var(--stone); font-weight: bold; color: #fff; }
        .btn-round:active { border-style: inset; transform: scale(0.95); }

        canvas { display: block; image-rendering: pixelated; }
    </style>
</head>
<body>

    <div id="class-selection">
        <h1 style="color:var(--gold); margin-bottom:30px;">MYTHICA ONLINE</h1>
        <div class="class-card" onclick="start('WARRIOR')">丘덢잺 GUERRERO<br><small>Alta Defensa / Da침o F칤sico</small></div>
        <div class="class-card" onclick="start('MAGE')">游댩 MAGO<br><small>Da침o de 츼rea / Man치 Inmenso</small></div>
        <div class="class-card" onclick="start('ARCHER')">游낓 ARQUERO<br><small>Velocidad / Cr칤ticos</small></div>
    </div>

    <div id="hud">
        <div id="p-name" style="font-weight:bold; color:var(--gold)">Player</div>
        <div style="font-size:10px">Nivel: <span id="p-lvl">1</span></div>
        <div class="bar-container"><div class="bar-txt" id="hp-txt">100/100</div><div id="hp-fill" class="bar-fill" style="background:var(--health)"></div></div>
        <div class="bar-container"><div class="bar-txt" id="mp-txt">50/50</div><div id="mp-fill" class="bar-fill" style="background:var(--mana)"></div></div>
        <div style="font-weight:bold; color:var(--gold); font-size:13px">游눯 <span id="p-gold">0</span></div>
    </div>

    <div id="joy"><div id="stick"></div></div>

    <div id="main-menu">
        <div class="tabs">
            <div class="tab active" onclick="tab(event, 'v-char')">PERSONAJE</div>
            <div class="tab" onclick="tab(event, 'v-back')">BACKPACK</div>
            <div class="tab" onclick="tab(event, 'v-log')">DIARIO</div>
            <div class="tab" style="background:#500; color:#fff; flex:0.4" onclick="toggleMenu()">CERRAR</div>
        </div>
        <div id="v-char" class="view">
            <div class="panel-inset" id="stats-render"></div>
            <div class="panel-inset" style="background:#000; color:#0f0; font-family:monospace; font-size:11px" id="battle-log">Log de batalla listo...</div>
        </div>
        <div id="v-back" class="view" style="display:none">
            <h4 style="margin:0 0 10px 0">PERSONAL BACKPACK</h4>
            <div class="inv-grid" id="bp-personal"></div>
            <h4 style="margin:20px 0 10px 0">LOOT BACKPACK</h4>
            <div class="inv-grid" id="bp-loot"></div>
        </div>
        <div id="v-log" class="view" style="display:none">
            <div id="bestiary-list"></div>
        </div>
    </div>

    <div class="action-btns" id="ui-actions">
        <button class="btn-round" style="background:#822" onclick="attack()">ATK</button>
        <button class="btn-round" onclick="toggleMenu()">MENU</button>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    // Base de datos de Monstruos por Tiers
    const monsterLib = [
        { name: "Slime T칩xico", t: 1, hp: 80, def: 5, color: "var(--t1)", exp: 40 },
        { name: "Lobo Alfa", t: 2, hp: 250, def: 15, color: "var(--t2)", exp: 150 },
        { name: "Minotauro Aplastador", t: 3, hp: 700, def: 40, color: "var(--t3)", exp: 500 },
        { name: "Behemoth Glacial", t: 4, hp: 2000, def: 90, color: "var(--t4)", exp: 1800 },
        { name: "Drag칩n de Plasma", t: 5, hp: 7000, def: 200, color: "var(--t5)", exp: 8000 },
        { name: "El Abismal", t: 6, hp: 40000, def: 500, color: "var(--t6)", exp: 50000 }
    ];

    let p = {
        clase: '', lvl: 1, exp: 0, next: 100, gold: 0,
        hp: 100, mHp: 100, mp: 50, mMp: 50,
        atk: 25, def: 10, x: 2500, y: 2500, target: null
    };

    let mobs = [], active = false, move = {x:0, y:0}, pulse = 0;

    function start(clase) {
        p.clase = clase;
        if(clase === 'WARRIOR') { p.atk = 30; p.def = 25; p.mHp = 150; }
        if(clase === 'MAGE') { p.atk = 50; p.def = 5; p.mMp = 150; }
        p.hp = p.mHp; p.mp = p.mMp;
        
        document.getElementById('class-selection').style.display = 'none';
        ['hud', 'joy', 'ui-actions'].forEach(id => document.getElementById(id).style.display = 'block');
        if(clase==='WARRIOR') document.getElementById('ui-actions').style.display = 'flex';

        // Llenar slots
        for(let i=0; i<16; i++){
            document.getElementById('bp-personal').innerHTML += '<div class="slot"></div>';
            document.getElementById('bp-loot').innerHTML += '<div class="slot"></div>';
        }

        spawnBatch();
        active = true;
        updateHUD();
        loop();
    }

    function spawnBatch() {
        for(let i=0; i<25; i++) {
            let base = monsterLib[Math.floor(Math.random()*monsterLib.length)];
            mobs.push({ ...base, id: Math.random(), x: p.x + (Math.random()*2000-1000), y: p.y + (Math.random()*2000-1000), curHp: base.hp });
        }
    }

    function attack() {
        if(!p.target || Math.hypot(p.x-p.target.x, p.y-p.target.y) > 130) return;
        
        // F칍RMULA DE DA칌O TIBIA (Da침o - Defensa)
        let hit = (p.atk + Math.floor(Math.random()*20)) - p.target.def;
        if(hit < 0) hit = 0; 

        p.target.curHp -= hit;
        document.getElementById('battle-log').innerText = `Golpeas a ${p.target.name} por ${hit} de da침o.`;

        if(p.target.curHp <= 0) {
            p.gold += (p.target.t * 25);
            p.exp += p.target.exp;
            mobs = mobs.filter(m => m.id !== p.target.id);
            p.target = null;
            checkLvl();
            spawnBatch();
        }
        updateHUD();
    }

    function checkLvl() {
        if(p.exp >= p.next) {
            p.lvl++; p.exp = 0; p.next *= 1.6;
            p.mHp += 25; p.hp = p.mHp;
            document.getElementById('battle-log').innerText = "춰HAS SUBIDO DE NIVEL!";
        }
    }

    function updateHUD() {
        document.getElementById('hp-fill').style.width = (p.hp/p.mHp*100) + "%";
        document.getElementById('hp-txt').innerText = `${p.hp}/${p.mHp}`;
        document.getElementById('p-gold').innerText = p.gold;
        document.getElementById('p-lvl').innerText = p.lvl;
    }

    function loop() {
        if(!active) return;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        p.x += move.x * 5.5; p.y += move.y * 5.5;
        let cx = p.x - canvas.width/2, cy = p.y - canvas.height/2;
        pulse += 0.07;

        ctx.save();
        ctx.translate(-cx, -cy);

        // Grid de suelo
        ctx.strokeStyle = "#1a1a1a";
        for(let x = Math.floor(cx/80)*80; x < cx+canvas.width; x+=80) {
            for(let y = Math.floor(cy/80)*80; y < cy+canvas.height; y+=80) {
                ctx.strokeRect(x,y,80,80);
            }
        }

        mobs.forEach(m => {
            // AURA DE TIER DIN츼MICA
            ctx.beginPath();
            let g = ctx.createRadialGradient(m.x, m.y, 5, m.x, m.y, 45 + Math.sin(pulse)*10);
            g.addColorStop(0, m.color);
            g.addColorStop(1, "transparent");
            ctx.fillStyle = g;
            ctx.globalAlpha = 0.5;
            ctx.arc(m.x, m.y, 60, 0, Math.PI*2);
            ctx.fill();
            ctx.globalAlpha = 1;

            // MONSTRUO Y NOMBRE
            ctx.fillStyle = m.color;
            ctx.fillRect(m.x-20, m.y-20, 40, 40);
            
            ctx.fillStyle = "#fff";
            ctx.font = "bold 11px Arial";
            ctx.textAlign = "center";
            ctx.fillText(m.name, m.x, m.y - 35);

            // BARRA DE VIDA MINI
            ctx.fillStyle = "#333"; ctx.fillRect(m.x-20, m.y-50, 40, 5);
            ctx.fillStyle = "#0f0"; ctx.fillRect(m.x-20, m.y-50, (m.curHp/m.hp)*40, 5);

            if(p.target === m) {
                ctx.strokeStyle = "red"; ctx.lineWidth = 3;
                ctx.strokeRect(m.x-25, m.y-25, 50, 50);
            }
        });

        // PLAYER
        ctx.fillStyle = "#3e93ff";
        ctx.fillRect(p.x-25, p.y-25, 50, 50);
        ctx.restore();

        requestAnimationFrame(loop);
    }

    // JOYSTICK LOGIC
    const joy = document.getElementById('joy'), stick = document.getElementById('stick');
    joy.addEventListener('touchmove', (e) => {
        let r = joy.getBoundingClientRect();
        let dx = e.touches[0].clientX - (r.left + 55), dy = e.touches[0].clientY - (r.top + 55);
        let d = Math.hypot(dx, dy);
        if(d > 40) { dx *= 40/d; dy *= 40/d; }
        stick.style.transform = `translate(${dx}px, ${dy}px)`;
        move = { x: dx/40, y: dy/40 };
    });
    joy.addEventListener('touchend', () => { move={x:0, y:0}; stick.style.transform='translate(0,0)'; });

    function toggleMenu() {
        let m = document.getElementById('main-menu');
        m.style.display = (m.style.display==='flex'?'none':'flex');
    }

    function tab(e, id) {
        document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).style.display = 'block';
        e.currentTarget.classList.add('active');
    }

    canvas.addEventListener('touchstart', (e) => {
        let tx = e.touches[0].clientX + (p.x - canvas.width/2);
        let ty = e.touches[0].clientY + (p.y - canvas.height/2);
        p.target = null;
        mobs.forEach(m => { if(Math.hypot(tx-m.x, ty-m.y) < 60) p.target = m; });
    });

    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
</script>
</body>
</html>
