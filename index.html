<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mythica Adventure - Backpack System</title>
    <style>
        :root { 
            --gold: #d4af37; --health: #ff3e3e; --mana: #3e93ff; --exp: #4caf50;
            --beige: #e5d3b3; --dark: #1a1a1a; --panel: #d2b48c;
        }
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Verdana', sans-serif; }
        
        /* HUD Y JOYSTICK */
        #hud { position: absolute; top: 15px; left: 15px; background: var(--beige); padding: 12px; border: 3px solid #000; z-index: 1000; display: none; }
        .bar-wrap { width: 180px; height: 16px; background: #222; border: 2px solid #000; margin-top: 5px; position: relative; }
        .bar-fill { height: 100%; transition: width 0.3s; }
        .bar-txt { position: absolute; width: 100%; text-align: center; font-size: 10px; color: #fff; line-height: 16px; font-weight: bold; }

        #joy { position: absolute; bottom: 50px; left: 50px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border: 2px solid var(--beige); border-radius: 50%; z-index: 500; display: none; }
        #stick { position: absolute; width: 50px; height: 50px; background: var(--beige); border-radius: 50%; top: 35px; left: 35px; }

        /* MENU MAESTRO */
        #main-menu { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; height: 85%; background: var(--panel); border: 4px solid #000;
            display: none; flex-direction: column; z-index: 2000;
        }
        .tabs { display: flex; background: #222; height: 45px; }
        .tab { flex: 1; color: var(--beige); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; border: 1px solid #444; }
        .tab.active { background: var(--panel); color: #000; }
        
        .view { flex: 1; padding: 15px; overflow-y: auto; display: none; }
        .view.active { display: block; }

        /* BACKPACK STYLES */
        .backpack-label { background: #333; color: var(--beige); padding: 5px; font-size: 10px; font-weight: bold; display: flex; justify-content: space-between; margin-top: 10px; }
        .inv-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 5px; }
        .slot { aspect-ratio: 1/1; background: #b8a07e; border: 2px solid #000; display: flex; align-items: center; justify-content: center; font-size: 20px; position: relative; }
        .slot:active { background: var(--gold); }

        /* OTROS */
        .monster-item { padding: 8px; border-bottom: 1px solid rgba(0,0,0,0.2); font-size: 11px; display: flex; justify-content: space-between; }
        .action-btns { position: absolute; bottom: 35px; right: 35px; display: none; gap: 10px; z-index: 500; }
        .btn-act { width: 80px; height: 80px; background: var(--beige); border: 4px solid #000; font-weight: bold; border-radius: 12px; }

        #setup { position: absolute; inset: 0; background: #1a1a1a; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="setup">
        <h1 style="color:var(--beige)">MYTHICA ADVENTURE</h1>
        <button style="background:var(--beige); padding:15px; font-weight:bold; border:3px solid #000;" onclick="init()">INICIAR AVENTURA</button>
    </div>

    <div id="hud">
        <div id="p-lvl-txt" style="font-weight:bold; font-size:12px">ADVENTURER LVL 1</div>
        <div class="bar-wrap"><div class="bar-txt" id="hp-t">100/100</div><div id="hp-f" class="bar-fill" style="background:var(--health)"></div></div>
        <div class="bar-wrap"><div class="bar-txt" id="mp-t">50/50</div><div id="mp-f" class="bar-fill" style="background:var(--mana)"></div></div>
        <div id="gold-t" style="margin-top:5px; font-weight:bold">üí∞ 0000</div>
    </div>

    <div id="joy"><div id="stick"></div></div>

    <div id="main-menu">
        <div class="tabs">
            <div class="tab active" onclick="tab(event, 'v-perfil')">üë§ PERFIL</div>
            <div class="tab" onclick="tab(event, 'v-backpack')">üéí BACKPACK</div>
            <div class="tab" onclick="tab(event, 'v-diario')">‚öîÔ∏è DIARIO</div>
            <div class="tab" style="background:#822; color:#fff; flex:0.4" onclick="toggleMenu()">X</div>
        </div>

        <div id="v-perfil" class="view active">
            <div id="stats-render"></div>
            <hr>
            <b>T√çTULO ACTUAL:</b> <span id="active-title" style="color:var(--gold)">Novato</span>
            <div id="combat-math" style="margin-top:10px; background:#000; color:#0f0; padding:10px; font-family:monospace; font-size:11px">
                [SISTEMA DE AN√ÅLISIS]<br>Selecciona un monstruo...
            </div>
        </div>

        <div id="v-backpack" class="view">
            <div style="font-size: 10px; font-style: italic; margin-bottom: 5px;">Toca un √≠tem para moverlo entre backpacks o tirarlo al suelo.</div>
            
            <div class="backpack-label">PERSONAL BACKPACK <span>Slots: 16</span></div>
            <div class="inv-grid" id="backpack-personal"></div>
            
            <div class="backpack-label" style="background:#555">LOOT BACKPACK <span>Slots: 16</span></div>
            <div class="inv-grid" id="backpack-loot"></div>
        </div>

        <div id="v-diario" class="view">
            <div id="bestiary-list"></div>
        </div>
    </div>

    <div class="action-btns" id="g-ui">
        <button class="btn-act" style="background:#a44; color:#fff" onclick="attack()">ATK</button>
        <button class="btn-act" onclick="toggleMenu()">MENU</button>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    const imgP = new Image(); imgP.src = 'player.png';
    const imgF = new Image(); imgF.src = 'floor1.png';
    const imgM = new Image(); imgM.src = 'floor2.png';

    let p = {
        lvl: 1, gold: 0, hp: 100, mHp: 100, mp: 50, mMp: 50, x: 2500, y: 2500,
        target: null,
        stats: { str: 10, mag: 10, def: 10, agi: 10 },
        train: { str: 0, mag: 0, def: 0, agi: 0 }
    };

    let mobs = [], active = false, move = {x:0, y:0};

    const monsterMasterList = [
        {n: "Slime Cristalino", t: "TIER 1", l: "1-10", c: "#fff"},
        {n: "Kobold Minero", t: "TIER 1", l: "10-50", c: "#fff"},
        {n: "Lobo de Fenrir", t: "TIER 2", l: "50-150", c: "yellow"},
        {n: "Orco Merodeador", t: "TIER 2", l: "150-300", c: "yellow"},
        {n: "Minotauro Guardi√°n", t: "TIER 3", l: "300-600", c: "orange"},
        {n: "Vampiro Sangre Pura", t: "TIER 4", l: "600-1000", c: "red"},
        {n: "Drag√≥n de Plasma", t: "TIER 5", l: "1000-1500", c: "#f0f"},
        {n: "El Abismal (Cthulhu)", t: "TIER 6", l: "1500-2000", c: "#f0f"}
    ];

    function init() {
        document.getElementById('setup').style.display = 'none';
        ['hud', 'joy', 'g-ui'].forEach(id => document.getElementById(id).style.display = (id==='g-ui'?'flex':'block'));
        
        // Setup Backpack Slots
        for(let i=0; i<16; i++) {
            document.getElementById('backpack-personal').innerHTML += `<div class="slot" onclick="itemAction('personal', ${i})"></div>`;
            document.getElementById('backpack-loot').innerHTML += `<div class="slot" onclick="itemAction('loot', ${i})"></div>`;
        }

        monsterMasterList.forEach(m => {
            document.getElementById('bestiary-list').innerHTML += `<div class="monster-item" style="color:${m.c}"><b>${m.n}</b> [${m.t}] <span>Niv. ${m.l}</span></div>`;
        });

        spawnInitialmobs();
        active = true;
        updateUI();
        loop();
    }

    function spawnInitialmobs() {
        for(let i=0; i<25; i++) spawnMob();
    }

    function spawnMob() {
        mobs.push({ id: Math.random(), x: p.x + (Math.random()*1500-750), y: p.y + (Math.random()*1500-750), hp: 150, max: 150, aggro: false });
    }

    // JOYSTICK ORIGINAL RESTAURADO
    const joy = document.getElementById('joy'), stick = document.getElementById('stick');
    joy.addEventListener('touchmove', (e) => {
        const r = joy.getBoundingClientRect();
        const jx = r.left + 60, jy = r.top + 60;
        let dx = e.touches[0].clientX - jx, dy = e.touches[0].clientY - jy;
        const d = Math.hypot(dx, dy);
        if(d > 45) { dx *= 45/d; dy *= 45/d; }
        stick.style.transform = `translate(${dx}px, ${dy}px)`;
        move = { x: dx/45, y: dy/45 };
    });
    joy.addEventListener('touchend', () => { move = {x:0, y:0}; stick.style.transform = 'translate(0,0)'; });

    function itemAction(type, index) {
        let action = confirm(`¬øQu√© deseas hacer con el √≠tem en la ${type.toUpperCase()} BACKPACK?\n\n[OK] Mover / [Cancelar] Tirar al suelo`);
        if(action) {
            alert("√çtem movido con √©xito.");
        } else {
            alert("√çtem desechado. Ha ca√≠do al suelo.");
        }
    }

    function toggleMenu() {
        const m = document.getElementById('main-menu');
        const open = m.style.display !== 'flex';
        m.style.display = open ? 'flex' : 'none';
        if(open) refreshProfile();
    }

    function refreshProfile() {
        let html = "";
        for(let s in p.stats) {
            let prog = (p.train[s] / (p.stats[s]*10)) * 100;
            html += `<div style="background:#c5b291; border:2px solid #000; padding:10px; margin-bottom:5px;"><b>${s.toUpperCase()}: ${p.stats[s]}</b><div class="bar-wrap"><div class="bar-fill" style="background:var(--gold); width:${prog}%"></div></div></div>`;
        }
        document.getElementById('stats-render').innerHTML = html;
        if(p.target) {
            document.getElementById('combat-math').innerHTML = `[AN√ÅLISIS]<br>Target HP: ${p.target.hp}<br>Tu Da√±o: ${p.stats.str * 2}<br>Analiza tu estrategia.`;
        }
    }

    function tab(e, id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.currentTarget.classList.add('active');
    }

    function attack() {
        if(!p.target || Math.hypot(p.x - p.target.x, p.y - p.target.y) > 130) return;
        let d = p.stats.str * 2 + Math.floor(Math.random()*10);
        p.target.hp -= d; p.target.aggro = true;
        p.train.str++;
        if(p.train.str >= p.stats.str * 10) { p.stats.str++; p.train.str = 0; }
        if(p.target.hp <= 0) {
            p.gold += 35; mobs = mobs.filter(m => m.id !== p.target.id);
            p.target = null; spawnMob(); updateUI();
        }
    }

    function updateUI() {
        document.getElementById('hp-f').style.width = (p.hp/p.mHp)*100 + "%";
        document.getElementById('hp-t').innerText = `${p.hp}/${p.mHp}`;
        document.getElementById('gold-t').innerText = "üí∞ " + String(p.gold).padStart(4, '0');
    }

    function loop() {
        if(!active) return;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        p.x += move.x * 5.5; p.y += move.y * 5.5;
        let cx = p.x - canvas.width/2, cy = p.y - canvas.height/2;

        ctx.save(); ctx.translate(-cx, -cy);
        if(imgF.complete) {
            for(let i=Math.floor(cx/80)*80; i<cx+canvas.width; i+=80)
            for(let j=Math.floor(cy/80)*80; j<cy+canvas.height; j+=80) ctx.drawImage(imgF, i, j, 81, 81);
        }

        mobs.forEach(m => {
            if(m.aggro || Math.hypot(p.x-m.x, p.y-m.y) < 250) { m.x += (p.x-m.x)*0.015; m.y += (p.y-m.y)*0.015; }
            if(imgM.complete) ctx.drawImage(imgM, m.x-25, m.y-25, 50, 50);
            if(p.target === m) {
                ctx.strokeStyle = "rgba(255,0,0,0.8)"; ctx.lineWidth = 4;
                ctx.beginPath(); ctx.arc(m.x, m.y, 40, 0, 7); ctx.stroke();
            }
        });

        if(imgP.complete) ctx.drawImage(imgP, p.x-30, p.y-30, 60, 60);
        ctx.restore();
        requestAnimationFrame(loop);
    }

    canvas.addEventListener('touchstart', (e) => {
        const tx = e.touches[0].clientX + (p.x - canvas.width/2);
        const ty = e.touches[0].clientY + (p.y - canvas.height/2);
        p.target = null;
        mobs.forEach(m => { if(Math.hypot(tx-m.x, ty-m.y) < 60) p.target = m; });
    });

    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
</script>
</body>
</html>
