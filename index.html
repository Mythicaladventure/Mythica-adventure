<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mythica Adventure - Engine Pro</title>
    <style>
        :root { 
            --gold: #d4af37; --health: #ff3e3e; --mana: #3e93ff; --exp: #4caf50;
            --beige: #e5d3b3; --dark: #1a1a1a; --glow: rgba(255, 255, 255, 0.4);
            --panel: #d2b48c;
        }
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Courier New', monospace; }
        
        /* UI OVERLAY */
        #hud { position: absolute; top: 15px; left: 15px; background: var(--beige); padding: 12px; border: 3px solid #000; z-index: 100; display: none; box-shadow: 0 0 15px var(--glow); }
        .bar-wrap { width: 180px; height: 16px; background: #222; border: 2px solid #000; margin-top: 5px; position: relative; }
        .bar-fill { height: 100%; transition: width 0.3s; }
        .bar-txt { position: absolute; width: 100%; text-align: center; font-size: 10px; color: #fff; line-height: 16px; font-weight: bold; }

        /* JOYSTICK */
        #joy { position: absolute; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border: 2px solid var(--beige); border-radius: 50%; z-index: 200; display: none; }
        #stick { position: absolute; width: 50px; height: 50px; background: var(--beige); border-radius: 50%; top: 35px; left: 35px; box-shadow: 0 0 10px #000; }

        /* MENU MAESTRO */
        #main-menu { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 92%; height: 85%; background: var(--panel); border: 5px solid #000;
            display: none; flex-direction: column; z-index: 1000;
        }
        .tabs { display: flex; background: #1a1a1a; height: 50px; }
        .tab { flex: 1; color: var(--beige); display: flex; align-items: center; justify-content: center; font-size: 11px; cursor: pointer; border: 1px solid #333; }
        .tab.active { background: var(--beige); color: #000; font-weight: bold; }
        
        .view { flex: 1; padding: 20px; overflow-y: auto; display: none; }
        .view.active { display: block; }

        /* COMPONENTES INTERNOS */
        .info-msg { background: rgba(0,0,0,0.1); border-left: 4px solid #000; padding: 10px; margin-bottom: 15px; font-size: 12px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-card { background: #c5b291; border: 2px solid #000; padding: 10px; }
        .train-bg { width: 100%; height: 5px; background: #444; margin-top: 5px; }
        .train-fill { height: 100%; background: var(--gold); transition: width 0.2s; }

        .inv-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 10px; }
        .slot { aspect-ratio: 1/1; background: #b8a07e; border: 2px solid #000; display: flex; align-items: center; justify-content: center; }

        /* DMG */
        .dmg-text { position: absolute; font-weight: bold; font-size: 24px; text-shadow: 2px 2px #000; animation: floatUp 0.8s forwards; pointer-events: none; }
        @keyframes floatUp { to { transform: translateY(-100px); opacity: 0; } }

        /* SETUP */
        #setup { position: absolute; inset: 0; background: #1a1a1a; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
        .btn-class { background: var(--beige); border: 3px solid #000; padding: 15px; width: 180px; margin: 10px; font-weight: bold; text-align: center; }

        .game-btns { position: absolute; bottom: 30px; right: 30px; display: none; gap: 15px; z-index: 200; }
        .act-btn { width: 80px; height: 80px; background: var(--beige); border: 4px solid #000; font-weight: bold; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="setup">
        <h1 style="color:var(--beige); text-align:center;">MYTHICA<br>ADVENTURE</h1>
        <div class="btn-class" onclick="init('WARRIOR')">GUERRERO</div>
        <div class="btn-class" onclick="init('MAGE')">MAGO</div>
    </div>

    <div id="hud">
        <div id="p-lvl" style="font-weight:bold; font-size:12px">LVL 1</div>
        <div class="bar-wrap"><div class="bar-txt" id="hp-t">100/100</div><div id="hp-f" class="bar-fill" style="background:var(--health)"></div></div>
        <div class="bar-wrap"><div class="bar-txt" id="mp-t">50/50</div><div id="mp-f" class="bar-fill" style="background:var(--mana)"></div></div>
        <div id="gold-t" style="margin-top:5px; font-weight:bold">üí∞ 0000</div>
    </div>

    <div id="joy"><div id="stick"></div></div>

    <div id="main-menu">
        <div class="tabs">
            <div class="tab active" onclick="tab(event, 'v-stats')">üë§ PERFIL</div>
            <div class="tab" onclick="tab(event, 'v-inv')">üéí BOLSA</div>
            <div class="tab" onclick="tab(event, 'v-map')">‚öîÔ∏è DIARIO</div>
            <div class="tab" style="background:#600; color:#fff; flex:0.4" onclick="toggleMenu()">X</div>
        </div>

        <div id="v-stats" class="view active">
            <div class="info-msg">Tu fuerza aumenta con cada golpe. La constancia es la clave del poder en Mythica.</div>
            <div class="stat-grid">
                <div class="stat-card">FUERZA: <span id="s-str">10</span> <div class="train-bg"><div class="train-fill" id="t-str"></div></div></div>
                <div class="stat-card">MAGIA: <span id="s-mag">10</span> <div class="train-bg"><div class="train-fill" id="t-mag"></div></div></div>
                <div class="stat-card">DEFENSA: <span id="s-def">10</span> <div class="train-bg"><div class="train-fill" id="t-def"></div></div></div>
                <div class="stat-card">AGILIDAD: <span id="s-agi">10</span> <div class="train-bg"><div class="train-fill" id="t-agi"></div></div></div>
            </div>
            <div id="combat-analyst" style="margin-top:20px; background:#000; color:#0f0; padding:15px; font-family:monospace; font-size:12px; border-left: 4px solid #0f0;">
                [AN√ÅLISIS DE COMBATE]<br>Analizando objetivo...
            </div>
        </div>

        <div id="v-inv" class="view">
            <div class="info-msg">Mochila Personal y de Bot√≠n. Gestiona tu equipo con sabidur√≠a.</div>
            <b>MOCHILA PERSONAL</b><div class="inv-grid" id="inv-p"></div>
            <br><b>MOCHILA DE LOOT</b><div class="inv-grid" id="inv-l"></div>
        </div>

        <div id="v-map" class="view">
            <div class="info-msg">Bestiario de Tier 1 a Tier 6 (Nivel 1-2000).</div>
            <div id="bestiary-content"></div>
        </div>
    </div>

    <div class="game-btns" id="g-ui">
        <button class="act-btn" style="background:#a44; color:#fff" onclick="attack()">ATK</button>
        <button class="act-btn" onclick="toggleMenu()">MENU</button>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    // ASSETS
    const imgP = new Image(); imgP.src = 'player.png';
    const imgF = new Image(); imgF.src = 'floor1.png';
    const imgM = new Image(); imgM.src = 'floor2.png';

    let p = {
        clase: '', lvl: 1, hp: 100, mHp: 100, mp: 50, mMp: 50, gold: 0,
        x: 2500, y: 2500, target: null,
        stats: { str: 10, mag: 10, def: 10, agi: 10 },
        train: { str: 0, mag: 0, def: 0, agi: 0 }
    };

    let mobs = [], active = false, move = {x:0, y:0};
    const worldSize = 5000;

    function init(cl) {
        p.clase = cl;
        document.getElementById('setup').style.display = 'none';
        ['hud', 'joy', 'g-ui'].forEach(id => document.getElementById(id).style.display = 'block');
        if(cl==='MAGE') { p.hp = 70; p.mHp = 70; p.mp = 150; p.mMp = 150; }
        
        // Cargar slots
        const grids = ['inv-p', 'inv-l'];
        grids.forEach(g => {
            for(let i=0; i<16; i++) document.getElementById(g).innerHTML += '<div class="slot"></div>';
        });

        // Bestiario
        const bc = document.getElementById('bestiary-content');
        const tiers = [
            {n: "Gelatina Cristalina", t: "T1", l: "1-10", c: "#fff"},
            {n: "Cazador de Sombras", t: "T3", l: "100-300", c: "orange"},
            {n: "El Abismal", t: "T6", l: "1500-2000", c: "#f0f"}
        ];
        tiers.forEach(t => bc.innerHTML += `<div style="color:${t.c}; padding:5px; border-bottom:1px solid #000"><b>${t.n}</b> [${t.t}] - Niv.${t.l}</div>`);

        for(let i=0; i<30; i++) spawnMob();
        active = true;
        updateUI();
        loop();
    }

    function spawnMob() {
        mobs.push({ id: Math.random(), x: p.x + (Math.random()*800-400), y: p.y + (Math.random()*800-400), hp: 120, max: 120, aggro: false });
    }

    // JOYSTICK LOGIC (RESTAURADA)
    const joy = document.getElementById('joy'), stick = document.getElementById('stick');
    joy.addEventListener('touchmove', (e) => {
        const r = joy.getBoundingClientRect();
        const jx = r.left + 60, jy = r.top + 60;
        let dx = e.touches[0].clientX - jx, dy = e.touches[0].clientY - jy;
        const dist = Math.hypot(dx, dy);
        if(dist > 40) { dx *= 40/dist; dy *= 40/dist; }
        stick.style.transform = `translate(${dx}px, ${dy}px)`;
        move = { x: dx/40, y: dy/40 };
    });
    joy.addEventListener('touchend', () => { move = {x:0, y:0}; stick.style.transform = 'translate(0,0)'; });

    function toggleMenu() {
        const m = document.getElementById('main-menu');
        m.style.display = (m.style.display === 'flex' ? 'none' : 'flex');
        if(m.style.display === 'flex') {
            ['str','mag','def','agi'].forEach(s => {
                document.getElementById('s-'+s).innerText = p.stats[s];
                document.getElementById('t-'+s).style.width = (p.train[s]/(p.stats[s]*5))*100 + "%";
            });
            const analyst = document.getElementById('combat-analyst');
            if(p.target) {
                analyst.innerHTML = `[AN√ÅLISIS]<br>Objetivo: Mob LVL ?<br>Tu da√±o base: ${p.stats.str * 2}<br>Vida restante: ${p.target.hp} HP<br>Analiza tu da√±o para ganar.`;
            } else {
                analyst.innerHTML = "[AN√ÅLISIS]<br>Sin objetivo marcado.";
            }
        }
    }

    function tab(e, id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.currentTarget.classList.add('active');
    }

    function attack() {
        if(!p.target) return;
        if(Math.hypot(p.x - p.target.x, p.y - p.target.y) > 100) return;
        
        let d = p.stats.str * 2 + Math.floor(Math.random()*10);
        p.target.hp -= d;
        p.target.aggro = true;
        showDmg(p.target.x, p.target.y, d, "white");

        // ENTRENAMIENTO
        p.train.str++;
        if(p.train.str >= p.stats.str * 5) { p.stats.str++; p.train.str = 0; }

        if(p.target.hp <= 0) {
            p.gold += 20; spawnMob();
            mobs = mobs.filter(m => m.id !== p.target.id);
            p.target = null;
            updateUI();
        }
    }

    function showDmg(x, y, v, c) {
        const div = document.createElement('div');
        div.className = 'dmg-text';
        div.style.left = (x - (p.x - canvas.width/2)) + 'px';
        div.style.top = (y - (p.y - canvas.height/2)) + 'px';
        div.style.color = c; div.innerText = v;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 800);
    }

    function updateUI() {
        document.getElementById('hp-f').style.width = (p.hp/p.mHp)*100 + "%";
        document.getElementById('hp-t').innerText = `${p.hp}/${p.mHp}`;
        document.getElementById('gold-t').innerText = "üí∞ " + String(p.gold).padStart(4, '0');
    }

    function loop() {
        if(!active) return;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        
        p.x += move.x * 5; p.y += move.y * 5;
        let cx = p.x - canvas.width/2, cy = p.y - canvas.height/2;

        ctx.save(); ctx.translate(-cx, -cy);

        // Piso
        if(imgF.complete) {
            for(let i=Math.floor(cx/80)*80; i<cx+canvas.width; i+=80)
            for(let j=Math.floor(cy/80)*80; j<cy+canvas.height; j+=80) ctx.drawImage(imgF, i, j, 81, 81);
        } else { ctx.fillStyle="#222"; ctx.fillRect(cx,cy,canvas.width,canvas.height); }

        mobs.forEach(m => {
            if(m.aggro || Math.hypot(p.x-m.x, p.y-m.y) < 200) {
                m.x += (p.x-m.x)*0.015; m.y += (p.y-m.y)*0.015;
            }
            if(imgM.complete) ctx.drawImage(imgM, m.x-25, m.y-25, 50, 50);
            else { ctx.fillStyle="red"; ctx.fillRect(m.x-20, m.y-20, 40, 40); }

            // Aura de Target
            if(p.target === m) {
                ctx.strokeStyle = "rgba(255,0,0,0.8)"; ctx.lineWidth = 4;
                ctx.beginPath(); ctx.arc(m.x, m.y, 35, 0, Math.PI*2); ctx.stroke();
            }
        });

        if(imgP.complete) ctx.drawImage(imgP, p.x-30, p.y-30, 60, 60);
        else { ctx.fillStyle="cyan"; ctx.fillRect(p.x-25, p.y-25, 50, 50); }

        ctx.restore();
        requestAnimationFrame(loop);
    }

    canvas.addEventListener('touchstart', (e) => {
        const tx = e.touches[0].clientX + (p.x - canvas.width/2);
        const ty = e.touches[0].clientY + (p.y - canvas.height/2);
        p.target = null;
        mobs.forEach(m => { if(Math.hypot(tx-m.x, ty-m.y) < 60) p.target = m; });
    });

    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
</script>
</body>
</html>
